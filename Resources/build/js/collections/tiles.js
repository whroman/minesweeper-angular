var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};angular.module("CollectTiles",["ModelTile"]).factory("CollectTiles",function(ModelTile){var CollectTiles;return CollectTiles=function(){function CollectTiles(widthOrSavedGame,height,numOfMines){var Model,collection,tile,_i,_len,_ref;if(collection=this,this.model=Model=function(_super){function Model(){return Model.__super__.constructor.apply(this,arguments)}return __extends(Model,_super),Model.prototype.clear=function(){return Model.__super__.clear.call(this),collection.clearNeighbors(this)},Model}(ModelTile),Array.isArray(widthOrSavedGame))for(this.loadGame(widthOrSavedGame),this.x=Math.max.apply(this,this.all.map(function(tile){return tile.model.x})),this.y=Math.max.apply(this,this.all.map(function(tile){return tile.model.y})),this.x=this.x--,this.y=this.y--,this.numOfMines=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isMine===!0&&this.numOfMines++;else this.newGame(widthOrSavedGame,height,numOfMines),this.x=widthOrSavedGame,this.y=height,this.numOfMines=numOfMines;this.update()}return CollectTiles.prototype.add=function(model){var tile;return tile=new this.model(model),this.all.push(tile),tile},CollectTiles.prototype.update=function(){var tile,_i,_len,_ref;for(this.loss=!1,this.win=!1,this.numOfClears=0,this.numOfFlags=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isClear===!0&&this.numOfClears++,tile.model.isFlagged===!0&&this.numOfFlags++,tile.model.isMine===!0&&tile.model.isClear===!0&&(this.loss=!0);return this.loss===!1&&this.all.length-this.numOfMines-this.numOfClears===0?this.win=!0:void 0},CollectTiles.prototype.get=function(attrs){return this.getAll(attrs)[0]},CollectTiles.prototype.getAll=function(attrs){var key,matches,numOfAttrs,numOfMatchedAttrs,tile,val,_i,_j,_len,_len1,_ref,_ref1;if(matches=[],void 0===attrs)for(_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],matches.push(tile);else for(_ref1=this.all,_j=0,_len1=_ref1.length;_len1>_j;_j++){tile=_ref1[_j],numOfAttrs=0,numOfMatchedAttrs=0;for(key in attrs)val=attrs[key],numOfAttrs++,tile.model[key]===val&&numOfMatchedAttrs++;numOfMatchedAttrs===numOfAttrs&&matches.push(tile)}return matches},CollectTiles.prototype.tallyMines=function(){var adjacentTile,neighborAttrs,neighborMine,neighborMines,neighborX,neighborY,tile,_i,_j,_len,_len1,_ref,_ref1;for(_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++){for(tile=_ref[_i],neighborMines=0,_ref1=tile.adjacentTiles,_j=0,_len1=_ref1.length;_len1>_j;_j++)adjacentTile=_ref1[_j],neighborX=tile.model.x+adjacentTile[0],neighborY=tile.model.y+adjacentTile[1],neighborAttrs={isMine:!0,x:neighborX,y:neighborY},neighborMine=this.get(neighborAttrs),void 0!==neighborMine&&neighborMines++;tile.model.adjacentMines=neighborMines}return this},CollectTiles.prototype.randomSafeTile=function(){var findAttrs,randomIndex,safeTiles;return findAttrs={isClear:!1,isMine:!1},safeTiles=this.getAll(findAttrs),randomIndex=Math.floor(Math.random()*safeTiles.length),safeTiles[randomIndex]},CollectTiles.prototype.autoSelect=function(num){for(;num--;)this.randomSafeTile().clear();return this.all},CollectTiles.prototype.newGame=function(sizeX,sizeY,numOfMines){var attrs,mineNum,tile,x,y,_i,_j,_k,_ref,_ref1;for(this.reset(),y=_i=0,_ref=sizeY-1;_ref>=0?_ref>=_i:_i>=_ref;y=_ref>=0?++_i:--_i)for(x=_j=0,_ref1=sizeX-1;_ref1>=0?_ref1>=_j:_j>=_ref1;x=_ref1>=0?++_j:--_j)attrs={x:x,y:y},this.add(attrs);for(mineNum=_k=1;numOfMines>=1?numOfMines>=_k:_k>=numOfMines;mineNum=numOfMines>=1?++_k:--_k)tile=this.randomSafeTile(),tile.model.isMine=!0;return this.tallyMines()},CollectTiles.prototype.loadGame=function(savedTiles){var tile,_i,_len;for(this.reset(),_i=0,_len=savedTiles.length;_len>_i;_i++)tile=savedTiles[_i],this.add(tile.model);return this},CollectTiles.prototype.reset=function(){return this.all=[],this},CollectTiles.prototype.clearNeighbors=function(tile){var adjacentTile,neighbor,shouldClearNeighbor,shouldClearNeighbors,_i,_len,_ref;if(shouldClearNeighbors=0===tile.model.adjacentMines&&tile.model.isMine===!1)for(_ref=tile.adjacentTiles,_i=0,_len=_ref.length;_len>_i;_i++)adjacentTile=_ref[_i],neighbor=this.get({x:tile.model.x+adjacentTile[0],y:tile.model.y+adjacentTile[1]}),shouldClearNeighbor=neighbor&&neighbor.model.isClear===!1&&neighbor.model.isMine===!1,shouldClearNeighbor&&neighbor.clear();return this},CollectTiles}()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25zL3RpbGVzLmNvZmZlZSIsImNvbGxlY3Rpb25zL3RpbGVzLmpzIl0sIm5hbWVzIjpbIl9faGFzUHJvcCIsImhhc093blByb3BlcnR5IiwiX19leHRlbmRzIiwiY2hpbGQiLCJwYXJlbnQiLCJjdG9yIiwidGhpcyIsImNvbnN0cnVjdG9yIiwia2V5IiwiY2FsbCIsInByb3RvdHlwZSIsIl9fc3VwZXJfXyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiTW9kZWxUaWxlIiwiQ29sbGVjdFRpbGVzIiwid2lkdGhPclNhdmVkR2FtZSIsImhlaWdodCIsIm51bU9mTWluZXMiLCJNb2RlbCIsImNvbGxlY3Rpb24iLCJ0aWxlIiwiX2kiLCJfbGVuIiwiX3JlZiIsIm1vZGVsIiwiX3N1cGVyIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJjbGVhciIsImNsZWFyTmVpZ2hib3JzIiwiQXJyYXkiLCJpc0FycmF5IiwibG9hZEdhbWUiLCJ4IiwiTWF0aCIsIm1heCIsImFsbCIsIm1hcCIsInkiLCJsZW5ndGgiLCJpc01pbmUiLCJuZXdHYW1lIiwidXBkYXRlIiwiYWRkIiwicHVzaCIsImxvc3MiLCJ3aW4iLCJudW1PZkNsZWFycyIsIm51bU9mRmxhZ3MiLCJpc0NsZWFyIiwiaXNGbGFnZ2VkIiwiZ2V0IiwiYXR0cnMiLCJnZXRBbGwiLCJtYXRjaGVzIiwibnVtT2ZBdHRycyIsIm51bU9mTWF0Y2hlZEF0dHJzIiwidmFsIiwiX2oiLCJfbGVuMSIsIl9yZWYxIiwidGFsbHlNaW5lcyIsImFkamFjZW50VGlsZSIsIm5laWdoYm9yQXR0cnMiLCJuZWlnaGJvck1pbmUiLCJuZWlnaGJvck1pbmVzIiwibmVpZ2hib3JYIiwibmVpZ2hib3JZIiwiYWRqYWNlbnRUaWxlcyIsImFkamFjZW50TWluZXMiLCJyYW5kb21TYWZlVGlsZSIsImZpbmRBdHRycyIsInJhbmRvbUluZGV4Iiwic2FmZVRpbGVzIiwiZmxvb3IiLCJyYW5kb20iLCJhdXRvU2VsZWN0IiwibnVtIiwic2l6ZVgiLCJzaXplWSIsIm1pbmVOdW0iLCJfayIsInJlc2V0Iiwic2F2ZWRUaWxlcyIsIm5laWdoYm9yIiwic2hvdWxkQ2xlYXJOZWlnaGJvciIsInNob3VsZENsZWFyTmVpZ2hib3JzIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxjQUFBQyxlQ0NFQyxVQUFZLFNBQVNDLE1BQU9DLFFBQWlHLFFBQVNDLFFBQVNDLEtBQUtDLFlBQWNKLE1BQTVILElBQUssR0FBSUssT0FBT0osUUFBY0osVUFBVVMsS0FBS0wsT0FBUUksT0FBTUwsTUFBTUssS0FBT0osT0FBT0ksS0FBMkosT0FBckdILE1BQUtLLFVBQVlOLE9BQU9NLFVBQVdQLE1BQU1PLFVBQVksR0FBSUwsTUFBUUYsTUFBTVEsVUFBWVAsT0FBT00sVUFBa0JQLE1ERHpSUyxTQUNDQyxPQUFPLGdCQUVKLGNBR0hDLFFBQVEsZUFBZ0IsU0FDckJDLFdBRUEsR0FBQUMsYUNKRixPRElRQSxjQUFBLFdBQ1ksUUFBQUEsY0FBQ0MsaUJBQWtCQyxPQUFRQyxZQUdyQyxHQUFBQyxPQUFBQyxXQUFBQyxLQUFBQyxHQUFBQyxLQUFBQyxJQU9BLElBUEFKLFdBQWFmLEtBQ2JBLEtBQUNvQixNQUFjTixNQUFBLFNBQUFPLFFDRm5CLFFBQVNQLFNBQ1AsTUFBT0EsT0FBTVQsVUFBVUosWUFBWXFCLE1BQU10QixLQUFNdUIsV0FRakQsTUROUTNCLFdBQUFrQixNQUFBTyxRQUFBUCxNQUFBVixVQUFBb0IsTUFBTyxXQ0diLE1ERlVWLE9BQUFULFVBQUFtQixNQUFBckIsS0FBQUgsTUFDQWUsV0FBV1UsZUFBZXpCLE9DSS9CYyxPRFAwQkwsV0FNMUJpQixNQUFNQyxRQUFRaEIsa0JBZWIsSUFkQVgsS0FBQzRCLFNBQVNqQixrQkFFVlgsS0FBQzZCLEVBQUlDLEtBQUtDLElBQUlULE1BQU10QixLQUFHQSxLQUFDZ0MsSUFBSUMsSUFBSSxTQUFDakIsTUNJdkMsTURIVUEsTUFBS0ksTUFBTVMsS0FFZjdCLEtBQUNrQyxFQUFJSixLQUFLQyxJQUFJVCxNQUFNdEIs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aWxlIjoiY29sbGVjdGlvbnMvdGlsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyXG4ubW9kdWxlICdDb2xsZWN0VGlsZXMnLCBbXG4jIERlcGVuZGVuY2llc1xuICAgICdNb2RlbFRpbGUnLFxuXVxuXG4uZmFjdG9yeSAnQ29sbGVjdFRpbGVzJywgKFxuICAgIE1vZGVsVGlsZVxuKSAtPlxuICAgIGNsYXNzIENvbGxlY3RUaWxlc1xuICAgICAgICBjb25zdHJ1Y3RvciA6ICh3aWR0aE9yU2F2ZWRHYW1lLCBoZWlnaHQsIG51bU9mTWluZXMpIC0+XG5cbiAgICAgICAgICAgICMgRXh0ZW5kIE1vZGVsVGlsZSBzbyB0aGF0IGl0IGNhbiBleGVjdXRlIHNvbWUgY29sbGVjdGlvbiBsb2dpY1xuICAgICAgICAgICAgY29sbGVjdGlvbiA9IEBcbiAgICAgICAgICAgIEBtb2RlbCA9IGNsYXNzIE1vZGVsIGV4dGVuZHMgTW9kZWxUaWxlXG4gICAgICAgICAgICAgICAgY2xlYXI6IC0+XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyKClcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5jbGVhck5laWdoYm9ycyBAXG5cbiAgICAgICAgICAgICMgTG9hZCBvciBDcmVhdGUgbmV3IGdhbWVcbiAgICAgICAgICAgIGlmIEFycmF5LmlzQXJyYXkgd2lkdGhPclNhdmVkR2FtZVxuICAgICAgICAgICAgICAgIEBsb2FkR2FtZSB3aWR0aE9yU2F2ZWRHYW1lXG5cbiAgICAgICAgICAgICAgICBAeCA9IE1hdGgubWF4LmFwcGx5IEAsIEBhbGwubWFwICh0aWxlKSAtPlxuICAgICAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLnhcblxuICAgICAgICAgICAgICAgIEB5ID0gTWF0aC5tYXguYXBwbHkgQCwgQGFsbC5tYXAgKHRpbGUpIC0+XG4gICAgICAgICAgICAgICAgICAgIHRpbGUubW9kZWwueVxuXG4gICAgICAgICAgICAgICAgIyBPZmZzZXQgYnkgMSB0byBhY2NvdW50IGZvciAwIGluZGV4XG4gICAgICAgICAgICAgICAgQHggPSBAeC0tXG4gICAgICAgICAgICAgICAgQHkgPSBAeS0tXG5cblxuICAgICAgICAgICAgICAgIEBudW1PZk1pbmVzID0gMFxuICAgICAgICAgICAgICAgIGZvciB0aWxlIGluIEBhbGxcbiAgICAgICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbC5pc01pbmUgaXMgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgQG51bU9mTWluZXMrK1xuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgQG5ld0dhbWUgd2lkdGhPclNhdmVkR2FtZSwgaGVpZ2h0LCBudW1PZk1pbmVzXG4gICAgICAgICAgICAgICAgQHggPSB3aWR0aE9yU2F2ZWRHYW1lXG4gICAgICAgICAgICAgICAgQHkgPSBoZWlnaHRcbiAgICAgICAgICAgICAgICBAbnVtT2ZNaW5lcyA9IG51bU9mTWluZXNcblxuICAgICAgICAgICAgQHVwZGF0ZSgpXG5cbiAgICAgICAgICAgIEBcblxuXG4gICAgICAgIGFkZCA6IChtb2RlbCkgLT5cbiAgICAgICAgICAgIHRpbGUgPSBuZXcgQG1vZGVsIG1vZGVsXG4gICAgICAgICAgICBAYWxsLnB1c2ggdGlsZVxuICAgICAgICAgICAgdGlsZVxuXG4gICAgICAgIHVwZGF0ZSA6IC0+XG4gICAgICAgICAgICB0aGlzLmxvc3MgICAgPSBmYWxzZVxuICAgICAgICAgICAgdGhpcy53aW4gICAgID0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMubnVtT2ZDbGVhcnMgPSAwXG4gICAgICAgICAgICB0aGlzLm51bU9mRmxhZ3MgID0gMFxuXG4gICAgICAgICAgICBmb3IgdGlsZSBpbiBAYWxsXG4gICAgICAgICAgICAgICAgIyBDbGVhcmVkIFRpbGVzXG4gICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbC5pc0NsZWFyID09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1PZkNsZWFycysrXG5cbiAgICAgICAgICAgICAgICAjIEZsYWdnZWQgVGlsZXNcbiAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsLmlzRmxhZ2dlZCA9PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubnVtT2ZGbGFncysrXG5cbiAgICAgICAgICAgICAgICAjIENoZWNrIEdhbWUgTG9zc1xuICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNNaW5lID09IHRydWUgJiYgdGlsZS5tb2RlbC5pc0NsZWFyID09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb3NzID0gdHJ1ZVxuXG4gICAgICAgICAgICAjIENoZWNrIEdhbWUgV2luXG4gICAgICAgICAgICBpZiB0aGlzLmxvc3MgPT0gZmFsc2UgJiYgQGFsbC5sZW5ndGggLSB0aGlzLm51bU9mTWluZXMgLSB0aGlzLm51bU9mQ2xlYXJzID09IDBcbiAgICAgICAgICAgICAgICB0aGlzLndpbiA9IHRydWVcblxuICAgICAgICBnZXQgOiAoYXR0cnMpIC0+XG4gICAgICAgICAgICByZXR1cm4gQGdldEFsbChhdHRycylbMF1cblxuICAgICAgICBnZXRBbGwgOiAoYXR0cnMpIC0+XG4gICAgICAgICAgICBtYXRjaGVzID0gW11cbiAgICAgICAgICAgIGlmIGF0dHJzIGlzIHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIGZvciB0aWxlIGluIEBhbGxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoIHRpbGVcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBmb3IgdGlsZSBpbiBAYWxsXG4gICAgICAgICAgICAgICAgICAgIG51bU9mQXR0cnMgPSAwXG4gICAgICAgICAgICAgICAgICAgIG51bU9mTWF0Y2hlZEF0dHJzID0gMFxuICAgICAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWwgb2YgYXR0cnNcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mQXR0cnMrK1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbFtrZXldIGlzIHZhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTWF0Y2hlZEF0dHJzKytcblxuICAgICAgICAgICAgICAgICAgICBpZiBudW1PZk1hdGNoZWRBdHRycyBpcyBudW1PZkF0dHJzXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2ggdGlsZVxuXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1xuXG4gICAgICAgIHRhbGx5TWluZXMgOiAoKSAtPlxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGdldEFsbCgpXG4gICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lcyA9IDBcbiAgICAgICAgICAgICAgICBmb3IgYWRqYWNlbnRUaWxlIGluIHRpbGUuYWRqYWNlbnRUaWxlc1xuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvclggPSB0aWxlLm1vZGVsLnggKyBhZGphY2VudFRpbGVbMF0gXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yWSA9IHRpbGUubW9kZWwueSArIGFkamFjZW50VGlsZVsxXVxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvckF0dHJzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNNaW5lICA6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHggICAgICAgOiBuZWlnaGJvclhcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgICAgICAgOiBuZWlnaGJvcllcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvck1pbmUgPSB0aGlzLmdldChuZWlnaGJvckF0dHJzKVxuICAgICAgICAgICAgICAgICAgICBpZiBuZWlnaGJvck1pbmUgaXNudCB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yTWluZXMrK1xuICAgICAgICAgICAgICAgIHRpbGUubW9kZWwuYWRqYWNlbnRNaW5lcyA9IG5laWdoYm9yTWluZXNcblxuICAgICAgICAgICAgQFxuXG4gICAgICAgIHJhbmRvbVNhZmVUaWxlIDogKCkgLT5cbiAgICAgICAgICAgIGZpbmRBdHRycyA9XG4gICAgICAgICAgICAgICAgaXNDbGVhciA6IGZhbHNlXG4gICAgICAgICAgICAgICAgaXNNaW5lICA6IGZhbHNlXG5cbiAgICAgICAgICAgIHNhZmVUaWxlcyA9IEBnZXRBbGwgZmluZEF0dHJzXG4gICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IgTWF0aC5yYW5kb20oKSAqIHNhZmVUaWxlcy5sZW5ndGhcbiAgICAgICAgICAgIHJldHVybiBzYWZlVGlsZXNbIHJhbmRvbUluZGV4IF1cblxuICAgICAgICBhdXRvU2VsZWN0IDogKG51bSkgLT5cbiAgICAgICAgICAgIHdoaWxlIG51bS0tXG4gICAgICAgICAgICAgICAgQHJhbmRvbVNhZmVUaWxlKCkuY2xlYXIoKVxuXG4gICAgICAgICAgICBAYWxsXG5cbiAgICAgICAgbmV3R2FtZSA6IChzaXplWCwgc2l6ZVksIG51bU9mTWluZXMpIC0+XG4gICAgICAgICAgICBAcmVzZXQoKVxuICAgICAgICAgICAgZm9yIHkgaW4gWzAuLnNpemVZIC0gMV1cbiAgICAgICAgICAgICAgICBmb3IgeCBpbiBbMC4uc2l6ZVggLSAxXVxuICAgICAgICAgICAgICAgICAgICBhdHRycyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggICA6IHhcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgICA6IHlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBAYWRkIGF0dHJzXG5cbiAgICAgICAgICAgIGZvciBtaW5lTnVtIGluIFsxLi5udW1PZk1pbmVzXVxuICAgICAgICAgICAgICAgIHRpbGUgPSBAcmFuZG9tU2FmZVRpbGUoKVxuICAgICAgICAgICAgICAgIHRpbGUubW9kZWwuaXNNaW5lID0gdHJ1ZVxuXG4gICAgICAgICAgICBAdGFsbHlNaW5lcygpXG5cbiAgICAgICAgbG9hZEdhbWUgOiAoc2F2ZWRUaWxlcykgLT5cbiAgICAgICAgICAgIEByZXNldCgpXG4gICAgICAgICAgICBmb3IgdGlsZSBpbiBzYXZlZFRpbGVzXG4gICAgICAgICAgICAgICAgQGFkZCB0aWxlLm1vZGVsXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgcmVzZXQgOiAtPlxuICAgICAgICAgICAgQGFsbCA9IFtdXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgY2xlYXJOZWlnaGJvcnMgOiAodGlsZSkgLT5cbiAgICAgICAgICAgIHNob3VsZENsZWFyTmVpZ2hib3JzID0gdGlsZS5tb2RlbC5hZGphY2VudE1pbmVzIGlzIDAgYW5kIHRpbGUubW9kZWwuaXNNaW5lIGlzIGZhbHNlXG4gICAgICAgICAgICBpZiBzaG91bGRDbGVhck5laWdoYm9yc1xuICAgICAgICAgICAgICAgIGZvciBhZGphY2VudFRpbGUgaW4gdGlsZS5hZGphY2VudFRpbGVzXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yID0gQGdldChcbiAgICAgICAgICAgICAgICAgICAgICAgIHggOiB0aWxlLm1vZGVsLnggKyBhZGphY2VudFRpbGVbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgIHkgOiB0aWxlLm1vZGVsLnkgKyBhZGphY2VudFRpbGVbMV1cbiAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgIHNob3VsZENsZWFyTmVpZ2hib3IgPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWlnaGJvciBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLm1vZGVsLmlzQ2xlYXIgaXMgZmFsc2UgYW5kXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWlnaGJvci5tb2RlbC5pc01pbmUgaXMgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIHNob3VsZENsZWFyTmVpZ2hib3JcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLmNsZWFyKClcblxuICAgICAgICAgICAgQCIsbnVsbF0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9