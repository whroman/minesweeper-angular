var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};angular.module("CollectTiles",["ModelTile"]).factory("CollectTiles",function(ModelTile,$rootScope){var CollectTiles;return CollectTiles=function(){function CollectTiles(widthOrSavedGame,height,numOfMines){var Model,collection,tile,_i,_len,_ref;if(collection=this,this.model=Model=function(_super){function Model(){return Model.__super__.constructor.apply(this,arguments)}return __extends(Model,_super),Model.prototype.clear=function(){return Model.__super__.clear.call(this),collection.clearNeighbors(this),collection.update()},Model.prototype.toggleFlag=function(){return Model.__super__.toggleFlag.call(this),collection.update()},Model.prototype.click=function($event){return collection.noMineFirstClick(this),Model.__super__.click.call(this,$event)},Model}(ModelTile),Array.isArray(widthOrSavedGame))for(this.loadGame(widthOrSavedGame),this.x=Math.max.apply(this,this.all.map(function(tile){return tile.model.x})),this.y=Math.max.apply(this,this.all.map(function(tile){return tile.model.y})),this.x=this.x--,this.y=this.y--,this.numOfMines=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isMine===!0&&this.numOfMines++;else this.newGame(widthOrSavedGame,height,numOfMines),this.x=widthOrSavedGame,this.y=height,this.numOfMines=numOfMines;this.update()}return CollectTiles.prototype.add=function(model){var tile;return tile=new this.model(model),this.all.push(tile),tile},CollectTiles.prototype.update=function(){var tile,_i,_len,_ref;for(this.loss=!1,this.win=!1,this.numOfClears=0,this.numOfFlags=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isClear===!0&&this.numOfClears++,tile.model.isFlagged===!0&&this.numOfFlags++,tile.model.isMine===!0&&tile.model.isClear===!0&&(this.loss=!0);return this.loss===!1&&this.all.length-this.numOfMines-this.numOfClears===0&&(this.win=!0),$rootScope.$broadcast("Tiles:Updated"),this},CollectTiles.prototype.get=function(attrs){return this.getAll(attrs)[0]},CollectTiles.prototype.getAll=function(attrs){var key,matches,numOfAttrs,numOfMatchedAttrs,tile,val,_i,_j,_len,_len1,_ref,_ref1;if(matches=[],void 0===attrs)for(_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],matches.push(tile);else for(_ref1=this.all,_j=0,_len1=_ref1.length;_len1>_j;_j++){tile=_ref1[_j],numOfAttrs=0,numOfMatchedAttrs=0;for(key in attrs)val=attrs[key],numOfAttrs++,tile.model[key]===val&&numOfMatchedAttrs++;numOfMatchedAttrs===numOfAttrs&&matches.push(tile)}return matches},CollectTiles.prototype.tallyMines=function(){var adjacentTile,neighborAttrs,neighborMine,neighborMines,neighborX,neighborY,tile,_i,_j,_len,_len1,_ref,_ref1;for(_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++){for(tile=_ref[_i],neighborMines=0,_ref1=tile.adjacentTiles,_j=0,_len1=_ref1.length;_len1>_j;_j++)adjacentTile=_ref1[_j],neighborX=tile.model.x+adjacentTile[0],neighborY=tile.model.y+adjacentTile[1],neighborAttrs={isMine:!0,x:neighborX,y:neighborY},neighborMine=this.get(neighborAttrs),void 0!==neighborMine&&neighborMines++;tile.model.adjacentMines=neighborMines}return this},CollectTiles.prototype.randomSafeTile=function(){var findAttrs,randomIndex,safeTiles;return findAttrs={isClear:!1,isMine:!1},safeTiles=this.getAll(findAttrs),randomIndex=Math.floor(Math.random()*safeTiles.length),safeTiles[randomIndex]},CollectTiles.prototype.autoSelect=function(num){for(;num--;)this.randomSafeTile().clear();return this.all},CollectTiles.prototype.newGame=function(sizeX,sizeY,numOfMines){var attrs,mineNum,tile,x,y,_i,_j,_k,_ref,_ref1;for(this.reset(),y=_i=0,_ref=sizeY-1;_ref>=0?_ref>=_i:_i>=_ref;y=_ref>=0?++_i:--_i)for(x=_j=0,_ref1=sizeX-1;_ref1>=0?_ref1>=_j:_j>=_ref1;x=_ref1>=0?++_j:--_j)attrs={x:x,y:y},this.add(attrs);for(mineNum=_k=1;numOfMines>=1?numOfMines>=_k:_k>=numOfMines;mineNum=numOfMines>=1?++_k:--_k)tile=this.randomSafeTile(),tile.model.isMine=!0;return this.tallyMines(),this.update(),$rootScope.$broadcast("Tiles:NewGame"),this},CollectTiles.prototype.loadGame=function(savedTiles){var tile,_i,_len;for(this.reset(),_i=0,_len=savedTiles.length;_len>_i;_i++)tile=savedTiles[_i],this.add(tile.model);return this.update()},CollectTiles.prototype.reset=function(){return this.all=[],this},CollectTiles.prototype.noMineFirstClick=function(tile){return 0===this.numOfClears&&tile.model.isMine===!0&&(tile.model.isMine=!1,this.randomSafeTile().model.isMine=!0,this.tallyMines()),tile},CollectTiles.prototype.clearNeighbors=function(tile){var adjacentTile,neighbor,shouldClearNeighbor,shouldClearNeighbors,_i,_len,_ref;if(shouldClearNeighbors=0===tile.model.adjacentMines&&tile.model.isMine===!1)for(_ref=tile.adjacentTiles,_i=0,_len=_ref.length;_len>_i;_i++)adjacentTile=_ref[_i],neighbor=this.get({x:tile.model.x+adjacentTile[0],y:tile.model.y+adjacentTile[1]}),shouldClearNeighbor=neighbor&&neighbor.model.isClear===!1&&neighbor.model.isMine===!1,shouldClearNeighbor&&neighbor.clear();return this},CollectTiles}()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25zL3RpbGVzLmNvZmZlZSIsImNvbGxlY3Rpb25zL3RpbGVzLmpzIl0sIm5hbWVzIjpbIl9faGFzUHJvcCIsImhhc093blByb3BlcnR5IiwiX19leHRlbmRzIiwiY2hpbGQiLCJwYXJlbnQiLCJjdG9yIiwidGhpcyIsImNvbnN0cnVjdG9yIiwia2V5IiwiY2FsbCIsInByb3RvdHlwZSIsIl9fc3VwZXJfXyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiTW9kZWxUaWxlIiwiJHJvb3RTY29wZSIsIkNvbGxlY3RUaWxlcyIsIndpZHRoT3JTYXZlZEdhbWUiLCJoZWlnaHQiLCJudW1PZk1pbmVzIiwiTW9kZWwiLCJjb2xsZWN0aW9uIiwidGlsZSIsIl9pIiwiX2xlbiIsIl9yZWYiLCJtb2RlbCIsIl9zdXBlciIsImFwcGx5IiwiYXJndW1lbnRzIiwiY2xlYXIiLCJjbGVhck5laWdoYm9ycyIsInVwZGF0ZSIsInRvZ2dsZUZsYWciLCJjbGljayIsIiRldmVudCIsIm5vTWluZUZpcnN0Q2xpY2siLCJBcnJheSIsImlzQXJyYXkiLCJsb2FkR2FtZSIsIngiLCJNYXRoIiwibWF4IiwiYWxsIiwibWFwIiwieSIsImxlbmd0aCIsImlzTWluZSIsIm5ld0dhbWUiLCJhZGQiLCJwdXNoIiwibG9zcyIsIndpbiIsIm51bU9mQ2xlYXJzIiwibnVtT2ZGbGFncyIsImlzQ2xlYXIiLCJpc0ZsYWdnZWQiLCIkYnJvYWRjYXN0IiwiZ2V0IiwiYXR0cnMiLCJnZXRBbGwiLCJtYXRjaGVzIiwibnVtT2ZBdHRycyIsIm51bU9mTWF0Y2hlZEF0dHJzIiwidmFsIiwiX2oiLCJfbGVuMSIsIl9yZWYxIiwidGFsbHlNaW5lcyIsImFkamFjZW50VGlsZSIsIm5laWdoYm9yQXR0cnMiLCJuZWlnaGJvck1pbmUiLCJuZWlnaGJvck1pbmVzIiwibmVpZ2hib3JYIiwibmVpZ2hib3JZIiwiYWRqYWNlbnRUaWxlcyIsImFkamFjZW50TWluZXMiLCJyYW5kb21TYWZlVGlsZSIsImZpbmRBdHRycyIsInJhbmRvbUluZGV4Iiwic2FmZVRpbGVzIiwiZmxvb3IiLCJyYW5kb20iLCJhdXRvU2VsZWN0IiwibnVtIiwic2l6ZVgiLCJzaXplWSIsIm1pbmVOdW0iLCJfayIsInJlc2V0Iiwic2F2ZWRUaWxlcyIsIm5laWdoYm9yIiwic2hvdWxkQ2xlYXJOZWlnaGJvciIsInNob3VsZENsZWFyTmVpZ2hib3JzIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxjQUFBQyxlQ0NFQyxVQUFZLFNBQVNDLE1BQU9DLFFBQWlHLFFBQVNDLFFBQVNDLEtBQUtDLFlBQWNKLE1BQTVILElBQUssR0FBSUssT0FBT0osUUFBY0osVUFBVVMsS0FBS0wsT0FBUUksT0FBTUwsTUFBTUssS0FBT0osT0FBT0ksS0FBMkosT0FBckdILE1BQUtLLFVBQVlOLE9BQU9NLFVBQVdQLE1BQU1PLFVBQVksR0FBSUwsTUFBUUYsTUFBTVEsVUFBWVAsT0FBT00sVUFBa0JQLE1ERHpSUyxTQUNDQyxPQUFPLGdCQUVKLGNBR0hDLFFBQVEsZUFBZ0IsU0FDckJDLFVBQ0FDLFlBRUEsR0FBQUMsYUNMRixPREtRQSxjQUFBLFdBQ1ksUUFBQUEsY0FBQ0MsaUJBQWtCQyxPQUFRQyxZQUdyQyxHQUFBQyxPQUFBQyxXQUFBQyxLQUFBQyxHQUFBQyxLQUFBQyxJQWlCQSxJQWpCQUosV0FBYWhCLEtBQ2JBLEtBQUNxQixNQUFjTixNQUFBLFNBQUFPLFFDSG5CLFFBQVNQLFNBQ1AsTUFBT0EsT0FBTVYsVUFBVUosWUFBWXNCLE1BQU12QixLQUFNd0IsV0FtQmpELE1EaEJRNUIsV0FBQW1CLE1BQUFPLFFBQUFQLE1BQUFYLFVBQUFxQixNQUFPLFdDR2IsTURGVVYsT0FBQVYsVUFBQW9CLE1BQUF0QixLQUFBSCxNQUNBZ0IsV0FBV1UsZUFBZTFCLE1BQzFCZ0IsV0FBV1csVUFIZlosTUFBQVgsVUFLQXdCLFdBQVksV0NHbEIsTURGVWIsT0FBQVYsVUFBQXVCLFdBQUF6QixLQUFBSCxNQUNBZ0IsV0FBV1csVUFQZlosTUFBQVgsVUFTQXlC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QUFTLEVBQ3BCMUMsS0FBQ3dFLGlCQUFpQm5ELE1BQU1xQixRQUFTLEVBQ2pDMUMsS0FBQytELGNBRUU5QyxNQTFLWE4sYUFBQVAsVUE0S0FzQixlQUFpQixTQUFDVCxNQUNkLEdBQUErQyxjQUFBc0IsU0FBQUMsb0JBQUFDLHFCQUFBdEUsR0FBQUMsS0FBQUMsSUFDQSxJQURBb0UscUJBQW1ELElBQTVCdkUsS0FBS0ksTUFBTWtELGVBQXVCdEQsS0FBS0ksTUFBTXFCLFVBQVUsRUFFMUUsSUFBQXRCLEtBQUFILEtBQUFxRCxjQUFBcEQsR0FBQSxFQUFBQyxLQUFBQyxLQUFBcUIsT0FBQXRCLEtBQUFELEdBQUFBLEtDdUNOOEMsYUFBZTVDLEtBQUtGLElEdENWb0UsU0FBV3RGLEtBQUNxRCxLQUNSbEIsRUFBSWxCLEtBQUtJLE1BQU1jLEVBQUk2QixhQUFhLEdBQ2hDeEIsRUFBSXZCLEtBQUtJLE1BQU1tQixFQUFJd0IsYUFBYSxLQUdwQ3VCLG9CQUNJRCxVQUNBQSxTQUFTakUsTUFBTTZCLFdBQVcsR0FDMUJvQyxTQUFTakUsTUFBTXFCLFVBQVUsRUFHMUI2QyxxQkFDQ0QsU0FBUzdELE9DcUMzQixPRG5DTXpCLE9Dc0NEVyIsImZpbGUiOiJjb2xsZWN0aW9ucy90aWxlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXJcbi5tb2R1bGUgJ0NvbGxlY3RUaWxlcycsIFtcbiMgRGVwZW5kZW5jaWVzXG4gICAgJ01vZGVsVGlsZScsXG5dXG5cbi5mYWN0b3J5ICdDb2xsZWN0VGlsZXMnLCAoXG4gICAgTW9kZWxUaWxlLFxuICAgICRyb290U2NvcGVcbikgLT5cbiAgICBjbGFzcyBDb2xsZWN0VGlsZXNcbiAgICAgICAgY29uc3RydWN0b3IgOiAod2lkdGhPclNhdmVkR2FtZSwgaGVpZ2h0LCBudW1PZk1pbmVzKSAtPlxuXG4gICAgICAgICAgICAjIEV4dGVuZCBNb2RlbFRpbGUgc28gdGhhdCBpdCBjYW4gZXhlY3V0ZSBzb21lIGNvbGxlY3Rpb24gbG9naWNcbiAgICAgICAgICAgIGNvbGxlY3Rpb24gPSBAXG4gICAgICAgICAgICBAbW9kZWwgPSBjbGFzcyBNb2RlbCBleHRlbmRzIE1vZGVsVGlsZVxuICAgICAgICAgICAgICAgIGNsZWFyOiAtPlxuICAgICAgICAgICAgICAgICAgICBzdXBlcigpXG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24uY2xlYXJOZWlnaGJvcnMgQFxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLnVwZGF0ZSgpXG5cbiAgICAgICAgICAgICAgICB0b2dnbGVGbGFnOiAtPlxuICAgICAgICAgICAgICAgICAgICBzdXBlcigpXG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24udXBkYXRlKClcblxuICAgICAgICAgICAgICAgIGNsaWNrOiAoJGV2ZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLm5vTWluZUZpcnN0Q2xpY2sgQFxuICAgICAgICAgICAgICAgICAgICBzdXBlciAkZXZlbnRcblxuXG4gICAgICAgICAgICAjIExvYWQgb3IgQ3JlYXRlIG5ldyBnYW1lXG4gICAgICAgICAgICBpZiBBcnJheS5pc0FycmF5IHdpZHRoT3JTYXZlZEdhbWVcbiAgICAgICAgICAgICAgICBAbG9hZEdhbWUgd2lkdGhPclNhdmVkR2FtZVxuXG4gICAgICAgICAgICAgICAgQHggPSBNYXRoLm1heC5hcHBseSBALCBAYWxsLm1hcCAodGlsZSkgLT5cbiAgICAgICAgICAgICAgICAgICAgdGlsZS5tb2RlbC54XG5cbiAgICAgICAgICAgICAgICBAeSA9IE1hdGgubWF4LmFwcGx5IEAsIEBhbGwubWFwICh0aWxlKSAtPlxuICAgICAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLnlcblxuICAgICAgICAgICAgICAgICMgT2Zmc2V0IGJ5IDEgdG8gYWNjb3VudCBmb3IgMCBpbmRleFxuICAgICAgICAgICAgICAgIEB4ID0gQHgtLVxuICAgICAgICAgICAgICAgIEB5ID0gQHktLVxuXG5cbiAgICAgICAgICAgICAgICBAbnVtT2ZNaW5lcyA9IDBcbiAgICAgICAgICAgICAgICBmb3IgdGlsZSBpbiBAYWxsXG4gICAgICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNNaW5lIGlzIHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIEBudW1PZk1pbmVzKytcblxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBuZXdHYW1lIHdpZHRoT3JTYXZlZEdhbWUsIGhlaWdodCwgbnVtT2ZNaW5lc1xuICAgICAgICAgICAgICAgIEB4ID0gd2lkdGhPclNhdmVkR2FtZVxuICAgICAgICAgICAgICAgIEB5ID0gaGVpZ2h0XG4gICAgICAgICAgICAgICAgQG51bU9mTWluZXMgPSBudW1PZk1pbmVzXG5cbiAgICAgICAgICAgIEB1cGRhdGUoKVxuXG4gICAgICAgIGFkZCA6IChtb2RlbCkgLT5cbiAgICAgICAgICAgIHRpbGUgPSBuZXcgQG1vZGVsIG1vZGVsXG4gICAgICAgICAgICBAYWxsLnB1c2ggdGlsZVxuICAgICAgICAgICAgdGlsZVxuXG4gICAgICAgIHVwZGF0ZSA6IC0+XG4gICAgICAgICAgICB0aGlzLmxvc3MgICAgPSBmYWxzZVxuICAgICAgICAgICAgdGhpcy53aW4gICAgID0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMubnVtT2ZDbGVhcnMgPSAwXG4gICAgICAgICAgICB0aGlzLm51bU9mRmxhZ3MgID0gMFxuXG4gICAgICAgICAgICBmb3IgdGlsZSBpbiBAYWxsXG4gICAgICAgICAgICAgICAgIyBDbGVhcmVkIFRpbGVzXG4gICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbC5pc0NsZWFyID09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1PZkNsZWFycysrXG5cbiAgICAgICAgICAgICAgICAjIEZsYWdnZWQgVGlsZXNcbiAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsLmlzRmxhZ2dlZCA9PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubnVtT2ZGbGFncysrXG5cbiAgICAgICAgICAgICAgICAjIENoZWNrIEdhbWUgTG9zc1xuICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNNaW5lID09IHRydWUgJiYgdGlsZS5tb2RlbC5pc0NsZWFyID09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb3NzID0gdHJ1ZVxuXG4gICAgICAgICAgICAjIENoZWNrIEdhbWUgV2luXG4gICAgICAgICAgICBpZiB0aGlzLmxvc3MgPT0gZmFsc2UgJiYgQGFsbC5sZW5ndGggLSB0aGlzLm51bU9mTWluZXMgLSB0aGlzLm51bU9mQ2xlYXJzID09IDBcbiAgICAgICAgICAgICAgICB0aGlzLndpbiA9IHRydWVcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0ICdUaWxlczpVcGRhdGVkJ1xuXG4gICAgICAgICAgICBAXG5cblxuICAgICAgICBnZXQgOiAoYXR0cnMpIC0+XG4gICAgICAgICAgICByZXR1cm4gQGdldEFsbChhdHRycylbMF1cblxuICAgICAgICBnZXRBbGwgOiAoYXR0cnMpIC0+XG4gICAgICAgICAgICBtYXRjaGVzID0gW11cbiAgICAgICAgICAgIGlmIGF0dHJzIGlzIHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIGZvciB0aWxlIGluIEBhbGxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoIHRpbGVcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBmb3IgdGlsZSBpbiBAYWxsXG4gICAgICAgICAgICAgICAgICAgIG51bU9mQXR0cnMgPSAwXG4gICAgICAgICAgICAgICAgICAgIG51bU9mTWF0Y2hlZEF0dHJzID0gMFxuICAgICAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWwgb2YgYXR0cnNcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mQXR0cnMrK1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbFtrZXldIGlzIHZhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTWF0Y2hlZEF0dHJzKytcblxuICAgICAgICAgICAgICAgICAgICBpZiBudW1PZk1hdGNoZWRBdHRycyBpcyBudW1PZkF0dHJzXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2ggdGlsZVxuXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1xuXG4gICAgICAgIHRhbGx5TWluZXMgOiAoKSAtPlxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGdldEFsbCgpXG4gICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lcyA9IDBcbiAgICAgICAgICAgICAgICBmb3IgYWRqYWNlbnRUaWxlIGluIHRpbGUuYWRqYWNlbnRUaWxlc1xuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvclggPSB0aWxlLm1vZGVsLnggKyBhZGphY2VudFRpbGVbMF0gXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yWSA9IHRpbGUubW9kZWwueSArIGFkamFjZW50VGlsZVsxXVxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvckF0dHJzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNNaW5lICA6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHggICAgICAgOiBuZWlnaGJvclhcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgICAgICAgOiBuZWlnaGJvcllcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvck1pbmUgPSB0aGlzLmdldChuZWlnaGJvckF0dHJzKVxuICAgICAgICAgICAgICAgICAgICBpZiBuZWlnaGJvck1pbmUgaXNudCB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yTWluZXMrK1xuICAgICAgICAgICAgICAgIHRpbGUubW9kZWwuYWRqYWNlbnRNaW5lcyA9IG5laWdoYm9yTWluZXNcblxuICAgICAgICAgICAgQFxuXG4gICAgICAgIHJhbmRvbVNhZmVUaWxlIDogKCkgLT5cbiAgICAgICAgICAgIGZpbmRBdHRycyA9XG4gICAgICAgICAgICAgICAgaXNDbGVhciA6IGZhbHNlXG4gICAgICAgICAgICAgICAgaXNNaW5lICA6IGZhbHNlXG5cbiAgICAgICAgICAgIHNhZmVUaWxlcyA9IEBnZXRBbGwgZmluZEF0dHJzXG4gICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IgTWF0aC5yYW5kb20oKSAqIHNhZmVUaWxlcy5sZW5ndGhcbiAgICAgICAgICAgIHJldHVybiBzYWZlVGlsZXNbIHJhbmRvbUluZGV4IF1cblxuICAgICAgICBhdXRvU2VsZWN0IDogKG51bSkgLT5cbiAgICAgICAgICAgIHdoaWxlIG51bS0tXG4gICAgICAgICAgICAgICAgQHJhbmRvbVNhZmVUaWxlKCkuY2xlYXIoKVxuXG4gICAgICAgICAgICBAYWxsXG5cbiAgICAgICAgbmV3R2FtZSA6IChzaXplWCwgc2l6ZVksIG51bU9mTWluZXMpIC0+XG4gICAgICAgICAgICBAcmVzZXQoKVxuICAgICAgICAgICAgZm9yIHkgaW4gWzAuLnNpemVZIC0gMV1cbiAgICAgICAgICAgICAgICBmb3IgeCBpbiBbMC4uc2l6ZVggLSAxXVxuICAgICAgICAgICAgICAgICAgICBhdHRycyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggICA6IHhcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgICA6IHlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBAYWRkIGF0dHJzXG5cbiAgICAgICAgICAgIGZvciBtaW5lTnVtIGluIFsxLi5udW1PZk1pbmVzXVxuICAgICAgICAgICAgICAgIHRpbGUgPSBAcmFuZG9tU2FmZVRpbGUoKVxuICAgICAgICAgICAgICAgIHRpbGUubW9kZWwuaXNNaW5lID0gdHJ1ZVxuXG4gICAgICAgICAgICBAdGFsbHlNaW5lcygpXG4gICAgICAgICAgICBAdXBkYXRlKClcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCAnVGlsZXM6TmV3R2FtZSdcbiAgICAgICAgICAgIEBcblxuICAgICAgICBsb2FkR2FtZSA6IChzYXZlZFRpbGVzKSAtPlxuICAgICAgICAgICAgQHJlc2V0KClcbiAgICAgICAgICAgIGZvciB0aWxlIGluIHNhdmVkVGlsZXNcbiAgICAgICAgICAgICAgICBAYWRkIHRpbGUubW9kZWxcbiAgICAgICAgICAgIEB1cGRhdGUoKVxuXG4gICAgICAgIHJlc2V0IDogLT5cbiAgICAgICAgICAgIEBhbGwgPSBbXVxuICAgICAgICAgICAgQFxuXG4gICAgICAgIG5vTWluZUZpcnN0Q2xpY2s6ICh0aWxlKSAtPlxuICAgICAgICAgICAgaWYgQG51bU9mQ2xlYXJzIGlzIDAgYW5kIHRpbGUubW9kZWwuaXNNaW5lIGlzIHRydWVcbiAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLmlzTWluZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgQHJhbmRvbVNhZmVUaWxlKCkubW9kZWwuaXNNaW5lID0gdHJ1ZVxuICAgICAgICAgICAgICAgIEB0YWxseU1pbmVzKClcblxuICAgICAgICAgICAgcmV0dXJuIHRpbGVcblxuICAgICAgICBjbGVhck5laWdoYm9ycyA6ICh0aWxlKSAtPlxuICAgICAgICAgICAgc2hvdWxkQ2xlYXJOZWlnaGJvcnMgPSB0aWxlLm1vZGVsLmFkamFjZW50TWluZXMgaXMgMCBhbmQgdGlsZS5tb2RlbC5pc01pbmUgaXMgZmFsc2VcbiAgICAgICAgICAgIGlmIHNob3VsZENsZWFyTmVpZ2hib3JzXG4gICAgICAgICAgICAgICAgZm9yIGFkamFjZW50VGlsZSBpbiB0aWxlLmFkamFjZW50VGlsZXNcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IgPSBAZ2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgeCA6IHRpbGUubW9kZWwueCArIGFkamFjZW50VGlsZVswXVxuICAgICAgICAgICAgICAgICAgICAgICAgeSA6IHRpbGUubW9kZWwueSArIGFkamFjZW50VGlsZVsxXVxuICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgc2hvdWxkQ2xlYXJOZWlnaGJvciA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IubW9kZWwuaXNDbGVhciBpcyBmYWxzZSBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLm1vZGVsLmlzTWluZSBpcyBmYWxzZVxuICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgc2hvdWxkQ2xlYXJOZWlnaGJvclxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IuY2xlYXIoKVxuXG4gICAgICAgICAgICBAIixudWxsXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=