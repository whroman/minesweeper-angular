var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};angular.module("CollectTiles",["ModelTile"]).factory("CollectTiles",function(ModelTile,$rootScope){var CollectTiles;return CollectTiles=function(){function CollectTiles(widthOrSavedGame,height,numOfMines){var Model,collection;collection=this,this.model=Model=function(_super){function Model(){return Model.__super__.constructor.apply(this,arguments)}return __extends(Model,_super),Model.prototype.clear=function(){return Model.__super__.clear.call(this),collection.clearNeighbors(this),collection.moveUpdate()},Model.prototype.toggleFlag=function(){return Model.__super__.toggleFlag.call(this),collection.moveUpdate()},Model.prototype.click=function($event){return collection.noMineFirstClick(this),Model.__super__.click.call(this,$event)},Model}(ModelTile),Array.isArray(widthOrSavedGame)?this.loadGame(widthOrSavedGame):(this.newGame(widthOrSavedGame,height,numOfMines),this.x=widthOrSavedGame,this.y=height,this.numOfMines=numOfMines),this.moveUpdate()}return CollectTiles.prototype.add=function(model){var tile;return tile=new this.model(model),this.all.push(tile),tile},CollectTiles.prototype.gameUpdate=function(){var tile,_i,_len,_ref;for(this.x=Math.max.apply(this,this.all.map(function(tile){return tile.model.x})),this.y=Math.max.apply(this,this.all.map(function(tile){return tile.model.y})),this.x=this.x--,this.y=this.y--,this.numOfMines=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isMine===!0&&this.numOfMines++;return this.moveUpdate()},CollectTiles.prototype.moveUpdate=function(){var tile,_i,_len,_ref;for(this.loss=!1,this.win=!1,this.numOfClears=0,this.numOfFlags=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isClear===!0&&this.numOfClears++,tile.model.isFlagged===!0&&this.numOfFlags++,tile.model.isMine===!0&&tile.model.isClear===!0&&(this.loss=!0);return this.loss===!1&&this.all.length-this.numOfMines-this.numOfClears===0&&(this.win=!0),$rootScope.$broadcast("Tiles:Updated"),this},CollectTiles.prototype.get=function(attrs){return this.getAll(attrs)[0]},CollectTiles.prototype.getAll=function(attrs){var key,matches,numOfAttrs,numOfMatchedAttrs,tile,val,_i,_len,_ref;if(matches=[],!attrs)return this.all;for(_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++){tile=_ref[_i],numOfAttrs=0,numOfMatchedAttrs=0;for(key in attrs)val=attrs[key],numOfAttrs++,tile.model[key]===val&&numOfMatchedAttrs++;numOfMatchedAttrs===numOfAttrs&&matches.push(tile)}return matches},CollectTiles.prototype.tallyMines=function(){var adjacentTile,neighborAttrs,neighborMine,neighborMines,neighborX,neighborY,tile,_i,_j,_len,_len1,_ref,_ref1;for(_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++){for(tile=_ref[_i],neighborMines=0,_ref1=tile.adjacentTiles,_j=0,_len1=_ref1.length;_len1>_j;_j++)adjacentTile=_ref1[_j],neighborX=tile.model.x+adjacentTile[0],neighborY=tile.model.y+adjacentTile[1],neighborAttrs={isMine:!0,x:neighborX,y:neighborY},neighborMine=this.get(neighborAttrs),void 0!==neighborMine&&neighborMines++;tile.model.adjacentMines=neighborMines}return this},CollectTiles.prototype.randomSafeTile=function(){var findAttrs,randomIndex,safeTiles;return findAttrs={isClear:!1,isMine:!1},safeTiles=this.getAll(findAttrs),randomIndex=Math.floor(Math.random()*safeTiles.length),safeTiles[randomIndex]},CollectTiles.prototype.autoSelect=function(num){for(;num--;)this.randomSafeTile().clear();return this.all},CollectTiles.prototype.newGame=function(sizeX,sizeY,numOfMines){var attrs,mineNum,tile,x,y,_i,_j,_k,_ref,_ref1;for(this.reset(),y=_i=0,_ref=sizeY-1;_ref>=0?_ref>=_i:_i>=_ref;y=_ref>=0?++_i:--_i)for(x=_j=0,_ref1=sizeX-1;_ref1>=0?_ref1>=_j:_j>=_ref1;x=_ref1>=0?++_j:--_j)attrs={x:x,y:y},this.add(attrs);for(mineNum=_k=1;numOfMines>=1?numOfMines>=_k:_k>=numOfMines;mineNum=numOfMines>=1?++_k:--_k)tile=this.randomSafeTile(),tile.model.isMine=!0;return this.tallyMines(),this.gameUpdate(),$rootScope.$broadcast("Tiles:NewGame"),this},CollectTiles.prototype.loadGame=function(savedTiles){var tile,_i,_len;for(this.reset(),_i=0,_len=savedTiles.length;_len>_i;_i++)tile=savedTiles[_i],this.add(tile.model);return this.gameUpdate()},CollectTiles.prototype.reset=function(){return this.all=[],this},CollectTiles.prototype.noMineFirstClick=function(tile){return 0===this.numOfClears&&tile.model.isMine===!0&&(tile.model.isMine=!1,this.randomSafeTile().model.isMine=!0,this.tallyMines()),tile},CollectTiles.prototype.clearNeighbors=function(tile){var adjacentTile,neighbor,shouldClearNeighbor,shouldClearNeighbors,_i,_len,_ref;if(shouldClearNeighbors=0===tile.model.adjacentMines&&tile.model.isMine===!1)for(_ref=tile.adjacentTiles,_i=0,_len=_ref.length;_len>_i;_i++)adjacentTile=_ref[_i],neighbor=this.get({x:tile.model.x+adjacentTile[0],y:tile.model.y+adjacentTile[1]}),shouldClearNeighbor=neighbor&&neighbor.model.isClear===!1&&neighbor.model.isMine===!1,shouldClearNeighbor&&neighbor.clear();return this},CollectTiles}()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25zL3RpbGVzLmNvZmZlZSIsImNvbGxlY3Rpb25zL3RpbGVzLmpzIl0sIm5hbWVzIjpbIl9faGFzUHJvcCIsImhhc093blByb3BlcnR5IiwiX19leHRlbmRzIiwiY2hpbGQiLCJwYXJlbnQiLCJjdG9yIiwidGhpcyIsImNvbnN0cnVjdG9yIiwia2V5IiwiY2FsbCIsInByb3RvdHlwZSIsIl9fc3VwZXJfXyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiTW9kZWxUaWxlIiwiJHJvb3RTY29wZSIsIkNvbGxlY3RUaWxlcyIsIndpZHRoT3JTYXZlZEdhbWUiLCJoZWlnaHQiLCJudW1PZk1pbmVzIiwiTW9kZWwiLCJjb2xsZWN0aW9uIiwibW9kZWwiLCJfc3VwZXIiLCJhcHBseSIsImFyZ3VtZW50cyIsImNsZWFyIiwiY2xlYXJOZWlnaGJvcnMiLCJtb3ZlVXBkYXRlIiwidG9nZ2xlRmxhZyIsImNsaWNrIiwiJGV2ZW50Iiwibm9NaW5lRmlyc3RDbGljayIsIkFycmF5IiwiaXNBcnJheSIsImxvYWRHYW1lIiwibmV3R2FtZSIsIngiLCJ5IiwiYWRkIiwidGlsZSIsImFsbCIsInB1c2giLCJnYW1lVXBkYXRlIiwiX2kiLCJfbGVuIiwiX3JlZiIsIk1hdGgiLCJtYXgiLCJtYXAiLCJsZW5ndGgiLCJpc01pbmUiLCJsb3NzIiwid2luIiwibnVtT2ZDbGVhcnMiLCJudW1PZkZsYWdzIiwiaXNDbGVhciIsImlzRmxhZ2dlZCIsIiRicm9hZGNhc3QiLCJnZXQiLCJhdHRycyIsImdldEFsbCIsIm1hdGNoZXMiLCJudW1PZkF0dHJzIiwibnVtT2ZNYXRjaGVkQXR0cnMiLCJ2YWwiLCJ0YWxseU1pbmVzIiwiYWRqYWNlbnRUaWxlIiwibmVpZ2hib3JBdHRycyIsIm5laWdoYm9yTWluZSIsIm5laWdoYm9yTWluZXMiLCJuZWlnaGJvclgiLCJuZWlnaGJvclkiLCJfaiIsIl9sZW4xIiwiX3JlZjEiLCJhZGphY2VudFRpbGVzIiwiYWRqYWNlbnRNaW5lcyIsInJhbmRvbVNhZmVUaWxlIiwiZmluZEF0dHJzIiwicmFuZG9tSW5kZXgiLCJzYWZlVGlsZXMiLCJmbG9vciIsInJhbmRvbSIsImF1dG9TZWxlY3QiLCJudW0iLCJzaXplWCIsInNpemVZIiwibWluZU51bSIsIl9rIiwicmVzZXQiLCJzYXZlZFRpbGVzIiwibmVpZ2hib3IiLCJzaG91bGRDbGVhck5laWdoYm9yIiwic2hvdWxkQ2xlYXJOZWlnaGJvcnMiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLGNBQUFDLGVDQ0VDLFVBQVksU0FBU0MsTUFBT0MsUUFBaUcsUUFBU0MsUUFBU0MsS0FBS0MsWUFBY0osTUFBNUgsSUFBSyxHQUFJSyxPQUFPSixRQUFjSixVQUFVUyxLQUFLTCxPQUFRSSxPQUFNTCxNQUFNSyxLQUFPSixPQUFPSSxLQUEySixPQUFyR0gsTUFBS0ssVUFBWU4sT0FBT00sVUFBV1AsTUFBTU8sVUFBWSxHQUFJTCxNQUFRRixNQUFNUSxVQUFZUCxPQUFPTSxVQUFrQlAsTUREelJTLFNBQ0NDLE9BQU8sZ0JBRUosY0FHSEMsUUFBUSxlQUFnQixTQUNyQkMsVUFDQUMsWUFFQSxHQUFBQyxhQ0xGLE9ES1FBLGNBQUEsV0FDWSxRQUFBQSxjQUFDQyxpQkFBa0JDLE9BQVFDLFlBR3JDLEdBQUFDLE9BQUFDLFVBQUFBLFlBQWFoQixLQUNiQSxLQUFDaUIsTUFBY0YsTUFBQSxTQUFBRyxRQ0huQixRQUFTSCxTQUNQLE1BQU9BLE9BQU1WLFVBQVVKLFlBQVlrQixNQUFNbkIsS0FBTW9CLFdBbUJqRCxNRGhCUXhCLFdBQUFtQixNQUFBRyxRQUFBSCxNQUFBWCxVQUFBaUIsTUFBTyxXQ0diLE1ERlVOLE9BQUFWLFVBQUFnQixNQUFBbEIsS0FBQUgsTUFDQWdCLFdBQVdNLGVBQWV0QixNQUMxQmdCLFdBQVdPLGNBSGZSLE1BQUFYLFVBS0FvQixXQUFZLFdDR2xCLE1ERlVULE9BQUFWLFVBQUFtQixXQUFBckIsS0FBQUgsTUFDQWdCLFdBQVdPLGNBUGZSLE1BQUFYLFVBU0FxQixNQUFPLFNBQUNDLFFD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QThLQWtCLGVBQWlCLFNBQUNhLE1BQ2QsR0FBQTJCLGNBQUF5QixTQUFBQyxvQkFBQUMscUJBQUFsRCxHQUFBQyxLQUFBQyxJQUNBLElBREFnRCxxQkFBbUQsSUFBNUJ0RCxLQUFLbEIsTUFBTXVELGVBQXVCckMsS0FBS2xCLE1BQU02QixVQUFVLEVBRTFFLElBQUFMLEtBQUFOLEtBQUFvQyxjQUFBaEMsR0FBQSxFQUFBQyxLQUFBQyxLQUFBSSxPQUFBTCxLQUFBRCxHQUFBQSxLQ3FDTnVCLGFBQWVyQixLQUFLRixJRHBDVmdELFNBQVd2RixLQUFDc0QsS0FDUnRCLEVBQUlHLEtBQUtsQixNQUFNZSxFQUFJOEIsYUFBYSxHQUNoQzdCLEVBQUlFLEtBQUtsQixNQUFNZ0IsRUFBSTZCLGFBQWEsS0FHcEMwQixvQkFDSUQsVUFDQUEsU0FBU3RFLE1BQU1rQyxXQUFXLEdBQzFCb0MsU0FBU3RFLE1BQU02QixVQUFVLEVBRzFCMEMscUJBQ0NELFNBQVNsRSxPQ21DM0IsT0RqQ01yQixPQ29DRFciLCJmaWxlIjoiY29sbGVjdGlvbnMvdGlsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyXG4ubW9kdWxlICdDb2xsZWN0VGlsZXMnLCBbXG4jIERlcGVuZGVuY2llc1xuICAgICdNb2RlbFRpbGUnLFxuXVxuXG4uZmFjdG9yeSAnQ29sbGVjdFRpbGVzJywgKFxuICAgIE1vZGVsVGlsZSxcbiAgICAkcm9vdFNjb3BlXG4pIC0+XG4gICAgY2xhc3MgQ29sbGVjdFRpbGVzXG4gICAgICAgIGNvbnN0cnVjdG9yIDogKHdpZHRoT3JTYXZlZEdhbWUsIGhlaWdodCwgbnVtT2ZNaW5lcykgLT5cblxuICAgICAgICAgICAgIyBFeHRlbmQgTW9kZWxUaWxlIHNvIHRoYXQgaXQgY2FuIGV4ZWN1dGUgc29tZSBjb2xsZWN0aW9uIGxvZ2ljXG4gICAgICAgICAgICBjb2xsZWN0aW9uID0gQFxuICAgICAgICAgICAgQG1vZGVsID0gY2xhc3MgTW9kZWwgZXh0ZW5kcyBNb2RlbFRpbGVcbiAgICAgICAgICAgICAgICBjbGVhcjogLT5cbiAgICAgICAgICAgICAgICAgICAgc3VwZXIoKVxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmNsZWFyTmVpZ2hib3JzIEBcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5tb3ZlVXBkYXRlKClcblxuICAgICAgICAgICAgICAgIHRvZ2dsZUZsYWc6IC0+XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyKClcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5tb3ZlVXBkYXRlKClcblxuICAgICAgICAgICAgICAgIGNsaWNrOiAoJGV2ZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLm5vTWluZUZpcnN0Q2xpY2sgQFxuICAgICAgICAgICAgICAgICAgICBzdXBlciAkZXZlbnRcblxuXG4gICAgICAgICAgICAjIExvYWQgb3IgQ3JlYXRlIG5ldyBnYW1lXG4gICAgICAgICAgICBpZiBBcnJheS5pc0FycmF5IHdpZHRoT3JTYXZlZEdhbWVcbiAgICAgICAgICAgICAgICBAbG9hZEdhbWUgd2lkdGhPclNhdmVkR2FtZVxuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgQG5ld0dhbWUgd2lkdGhPclNhdmVkR2FtZSwgaGVpZ2h0LCBudW1PZk1pbmVzXG4gICAgICAgICAgICAgICAgQHggPSB3aWR0aE9yU2F2ZWRHYW1lXG4gICAgICAgICAgICAgICAgQHkgPSBoZWlnaHRcbiAgICAgICAgICAgICAgICBAbnVtT2ZNaW5lcyA9IG51bU9mTWluZXNcblxuICAgICAgICAgICAgQG1vdmVVcGRhdGUoKVxuXG4gICAgICAgIGFkZCA6IChtb2RlbCkgLT5cbiAgICAgICAgICAgIHRpbGUgPSBuZXcgQG1vZGVsIG1vZGVsXG4gICAgICAgICAgICBAYWxsLnB1c2ggdGlsZVxuICAgICAgICAgICAgdGlsZVxuXG4gICAgICAgIGdhbWVVcGRhdGUgOiAtPlxuICAgICAgICAgICAgQHggPSBNYXRoLm1heC5hcHBseSBALCBAYWxsLm1hcCAodGlsZSkgLT5cbiAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLnhcblxuICAgICAgICAgICAgQHkgPSBNYXRoLm1heC5hcHBseSBALCBAYWxsLm1hcCAodGlsZSkgLT5cbiAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLnlcblxuICAgICAgICAgICAgIyBPZmZzZXQgYnkgMSB0byBhY2NvdW50IGZvciAwIGluZGV4XG4gICAgICAgICAgICBAeCA9IEB4LS1cbiAgICAgICAgICAgIEB5ID0gQHktLVxuXG5cbiAgICAgICAgICAgIEBudW1PZk1pbmVzID0gMFxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGFsbFxuICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNNaW5lIGlzIHRydWVcbiAgICAgICAgICAgICAgICAgICAgQG51bU9mTWluZXMrK1xuXG4gICAgICAgICAgICBAbW92ZVVwZGF0ZSgpO1xuXG4gICAgICAgIG1vdmVVcGRhdGUgOiAtPlxuICAgICAgICAgICAgdGhpcy5sb3NzICAgID0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMud2luICAgICA9IGZhbHNlXG4gICAgICAgICAgICB0aGlzLm51bU9mQ2xlYXJzID0gMFxuICAgICAgICAgICAgdGhpcy5udW1PZkZsYWdzICA9IDBcblxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGFsbFxuICAgICAgICAgICAgICAgICMgQ2xlYXJlZCBUaWxlc1xuICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNDbGVhciA9PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubnVtT2ZDbGVhcnMrK1xuXG4gICAgICAgICAgICAgICAgIyBGbGFnZ2VkIFRpbGVzXG4gICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbC5pc0ZsYWdnZWQgPT0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm51bU9mRmxhZ3MrK1xuXG4gICAgICAgICAgICAgICAgIyBDaGVjayBHYW1lIExvc3NcbiAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsLmlzTWluZSA9PSB0cnVlICYmIHRpbGUubW9kZWwuaXNDbGVhciA9PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9zcyA9IHRydWVcblxuICAgICAgICAgICAgIyBDaGVjayBHYW1lIFdpblxuICAgICAgICAgICAgaWYgdGhpcy5sb3NzID09IGZhbHNlICYmIEBhbGwubGVuZ3RoIC0gdGhpcy5udW1PZk1pbmVzIC0gdGhpcy5udW1PZkNsZWFycyA9PSAwXG4gICAgICAgICAgICAgICAgdGhpcy53aW4gPSB0cnVlXG5cbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCAnVGlsZXM6VXBkYXRlZCdcblxuICAgICAgICAgICAgQFxuXG4gICAgICAgIGdldCA6IChhdHRycykgLT5cbiAgICAgICAgICAgIHJldHVybiBAZ2V0QWxsKGF0dHJzKVswXVxuXG4gICAgICAgIGdldEFsbCA6IChhdHRycykgLT5cbiAgICAgICAgICAgIG1hdGNoZXMgPSBbXVxuICAgICAgICAgICAgaWYgIWF0dHJzXG4gICAgICAgICAgICAgICAgcmV0dXJuIEBhbGxcblxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGFsbFxuICAgICAgICAgICAgICAgIG51bU9mQXR0cnMgPSAwXG4gICAgICAgICAgICAgICAgbnVtT2ZNYXRjaGVkQXR0cnMgPSAwXG4gICAgICAgICAgICAgICAgZm9yIGtleSwgdmFsIG9mIGF0dHJzXG4gICAgICAgICAgICAgICAgICAgIG51bU9mQXR0cnMrK1xuICAgICAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsW2tleV0gaXMgdmFsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZk1hdGNoZWRBdHRycysrXG5cbiAgICAgICAgICAgICAgICBpZiBudW1PZk1hdGNoZWRBdHRycyBpcyBudW1PZkF0dHJzXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXMucHVzaCB0aWxlXG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzXG5cbiAgICAgICAgdGFsbHlNaW5lcyA6ICgpIC0+XG4gICAgICAgICAgICBmb3IgdGlsZSBpbiBAZ2V0QWxsKClcbiAgICAgICAgICAgICAgICBuZWlnaGJvck1pbmVzID0gMFxuICAgICAgICAgICAgICAgIGZvciBhZGphY2VudFRpbGUgaW4gdGlsZS5hZGphY2VudFRpbGVzXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yWCA9IHRpbGUubW9kZWwueCArIGFkamFjZW50VGlsZVswXSBcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JZID0gdGlsZS5tb2RlbC55ICsgYWRqYWNlbnRUaWxlWzFdXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yQXR0cnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc01pbmUgIDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgeCAgICAgICA6IG5laWdoYm9yWFxuICAgICAgICAgICAgICAgICAgICAgICAgeSAgICAgICA6IG5laWdoYm9yWVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yTWluZSA9IHRoaXMuZ2V0KG5laWdoYm9yQXR0cnMpXG4gICAgICAgICAgICAgICAgICAgIGlmIG5laWdoYm9yTWluZSBpc250IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lcysrXG4gICAgICAgICAgICAgICAgdGlsZS5tb2RlbC5hZGphY2VudE1pbmVzID0gbmVpZ2hib3JNaW5lc1xuXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgcmFuZG9tU2FmZVRpbGUgOiAoKSAtPlxuICAgICAgICAgICAgZmluZEF0dHJzID1cbiAgICAgICAgICAgICAgICBpc0NsZWFyIDogZmFsc2VcbiAgICAgICAgICAgICAgICBpc01pbmUgIDogZmFsc2VcblxuICAgICAgICAgICAgc2FmZVRpbGVzID0gQGdldEFsbCBmaW5kQXR0cnNcbiAgICAgICAgICAgIHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vciBNYXRoLnJhbmRvbSgpICogc2FmZVRpbGVzLmxlbmd0aFxuICAgICAgICAgICAgcmV0dXJuIHNhZmVUaWxlc1sgcmFuZG9tSW5kZXggXVxuXG4gICAgICAgIGF1dG9TZWxlY3QgOiAobnVtKSAtPlxuICAgICAgICAgICAgd2hpbGUgbnVtLS1cbiAgICAgICAgICAgICAgICBAcmFuZG9tU2FmZVRpbGUoKS5jbGVhcigpXG5cbiAgICAgICAgICAgIEBhbGxcblxuICAgICAgICBuZXdHYW1lIDogKHNpemVYLCBzaXplWSwgbnVtT2ZNaW5lcykgLT5cbiAgICAgICAgICAgIEByZXNldCgpXG4gICAgICAgICAgICBmb3IgeSBpbiBbMC4uc2l6ZVkgLSAxXVxuICAgICAgICAgICAgICAgIGZvciB4IGluIFswLi5zaXplWCAtIDFdXG4gICAgICAgICAgICAgICAgICAgIGF0dHJzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgeCAgIDogeFxuICAgICAgICAgICAgICAgICAgICAgICAgeSAgIDogeVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEBhZGQgYXR0cnNcblxuICAgICAgICAgICAgZm9yIG1pbmVOdW0gaW4gWzEuLm51bU9mTWluZXNdXG4gICAgICAgICAgICAgICAgdGlsZSA9IEByYW5kb21TYWZlVGlsZSgpXG4gICAgICAgICAgICAgICAgdGlsZS5tb2RlbC5pc01pbmUgPSB0cnVlXG5cbiAgICAgICAgICAgIEB0YWxseU1pbmVzKClcbiAgICAgICAgICAgIEBnYW1lVXBkYXRlKClcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCAnVGlsZXM6TmV3R2FtZSdcbiAgICAgICAgICAgIEBcblxuICAgICAgICBsb2FkR2FtZSA6IChzYXZlZFRpbGVzKSAtPlxuICAgICAgICAgICAgQHJlc2V0KClcbiAgICAgICAgICAgIGZvciB0aWxlIGluIHNhdmVkVGlsZXNcbiAgICAgICAgICAgICAgICBAYWRkIHRpbGUubW9kZWxcblxuICAgICAgICAgICAgQGdhbWVVcGRhdGUoKVxuXG4gICAgICAgIHJlc2V0IDogLT5cbiAgICAgICAgICAgIEBhbGwgPSBbXVxuICAgICAgICAgICAgQFxuXG4gICAgICAgIG5vTWluZUZpcnN0Q2xpY2s6ICh0aWxlKSAtPlxuICAgICAgICAgICAgaWYgQG51bU9mQ2xlYXJzIGlzIDAgYW5kIHRpbGUubW9kZWwuaXNNaW5lIGlzIHRydWVcbiAgICAgICAgICAgICAgICB0aWxlLm1vZGVsLmlzTWluZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgQHJhbmRvbVNhZmVUaWxlKCkubW9kZWwuaXNNaW5lID0gdHJ1ZVxuICAgICAgICAgICAgICAgIEB0YWxseU1pbmVzKClcblxuICAgICAgICAgICAgcmV0dXJuIHRpbGVcblxuICAgICAgICBjbGVhck5laWdoYm9ycyA6ICh0aWxlKSAtPlxuICAgICAgICAgICAgc2hvdWxkQ2xlYXJOZWlnaGJvcnMgPSB0aWxlLm1vZGVsLmFkamFjZW50TWluZXMgaXMgMCBhbmQgdGlsZS5tb2RlbC5pc01pbmUgaXMgZmFsc2VcbiAgICAgICAgICAgIGlmIHNob3VsZENsZWFyTmVpZ2hib3JzXG4gICAgICAgICAgICAgICAgZm9yIGFkamFjZW50VGlsZSBpbiB0aWxlLmFkamFjZW50VGlsZXNcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IgPSBAZ2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgeCA6IHRpbGUubW9kZWwueCArIGFkamFjZW50VGlsZVswXVxuICAgICAgICAgICAgICAgICAgICAgICAgeSA6IHRpbGUubW9kZWwueSArIGFkamFjZW50VGlsZVsxXVxuICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgc2hvdWxkQ2xlYXJOZWlnaGJvciA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IubW9kZWwuaXNDbGVhciBpcyBmYWxzZSBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLm1vZGVsLmlzTWluZSBpcyBmYWxzZVxuICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgc2hvdWxkQ2xlYXJOZWlnaGJvclxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IuY2xlYXIoKVxuXG4gICAgICAgICAgICBAIixudWxsXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=