var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};angular.module("CollectTiles",["ModelTile"]).factory("CollectTiles",function(ModelTile,$rootScope){var CollectTiles;return CollectTiles=function(){function CollectTiles(widthOrSavedGame,height,numOfMines){var Model,collection,tile,_i,_len,_ref;if(collection=this,this.model=Model=function(_super){function Model(){return Model.__super__.constructor.apply(this,arguments)}return __extends(Model,_super),Model.prototype.clear=function(){return Model.__super__.clear.call(this),collection.clearNeighbors(this),collection.update()},Model.prototype.toggleFlag=function(){return Model.__super__.toggleFlag.call(this),collection.update()},Model.prototype.click=function($event){return collection.noMineFirstClick(this),Model.__super__.click.call(this,$event)},Model}(ModelTile),Array.isArray(widthOrSavedGame))for(this.loadGame(widthOrSavedGame),this.x=Math.max.apply(this,this.all.map(function(tile){return tile.model.x})),this.y=Math.max.apply(this,this.all.map(function(tile){return tile.model.y})),this.x=this.x--,this.y=this.y--,this.numOfMines=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isMine===!0&&this.numOfMines++;else this.newGame(widthOrSavedGame,height,numOfMines),this.x=widthOrSavedGame,this.y=height,this.numOfMines=numOfMines}return CollectTiles.prototype.add=function(model){var tile;return tile=new this.model(model),this.all.push(tile),tile},CollectTiles.prototype.update=function(){var tile,_i,_len,_ref;for(this.loss=!1,this.win=!1,this.numOfClears=0,this.numOfFlags=0,_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],tile.model.isClear===!0&&this.numOfClears++,tile.model.isFlagged===!0&&this.numOfFlags++,tile.model.isMine===!0&&tile.model.isClear===!0&&(this.loss=!0);return this.loss===!1&&this.all.length-this.numOfMines-this.numOfClears===0&&(this.win=!0),$rootScope.$broadcast("Tiles:Updated"),this},CollectTiles.prototype.get=function(attrs){return this.getAll(attrs)[0]},CollectTiles.prototype.getAll=function(attrs){var key,matches,numOfAttrs,numOfMatchedAttrs,tile,val,_i,_j,_len,_len1,_ref,_ref1;if(matches=[],void 0===attrs)for(_ref=this.all,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],matches.push(tile);else for(_ref1=this.all,_j=0,_len1=_ref1.length;_len1>_j;_j++){tile=_ref1[_j],numOfAttrs=0,numOfMatchedAttrs=0;for(key in attrs)val=attrs[key],numOfAttrs++,tile.model[key]===val&&numOfMatchedAttrs++;numOfMatchedAttrs===numOfAttrs&&matches.push(tile)}return matches},CollectTiles.prototype.tallyMines=function(){var adjacentTile,neighborAttrs,neighborMine,neighborMines,neighborX,neighborY,tile,_i,_j,_len,_len1,_ref,_ref1;for(_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++){for(tile=_ref[_i],neighborMines=0,_ref1=tile.adjacentTiles,_j=0,_len1=_ref1.length;_len1>_j;_j++)adjacentTile=_ref1[_j],neighborX=tile.model.x+adjacentTile[0],neighborY=tile.model.y+adjacentTile[1],neighborAttrs={isMine:!0,x:neighborX,y:neighborY},neighborMine=this.get(neighborAttrs),void 0!==neighborMine&&neighborMines++;tile.model.adjacentMines=neighborMines}return this},CollectTiles.prototype.randomSafeTile=function(){var findAttrs,randomIndex,safeTiles;return findAttrs={isClear:!1,isMine:!1},safeTiles=this.getAll(findAttrs),randomIndex=Math.floor(Math.random()*safeTiles.length),safeTiles[randomIndex]},CollectTiles.prototype.autoSelect=function(num){for(;num--;)this.randomSafeTile().clear();return this.all},CollectTiles.prototype.newGame=function(sizeX,sizeY,numOfMines){var attrs,mineNum,tile,x,y,_i,_j,_k,_ref,_ref1;for(this.reset(),y=_i=0,_ref=sizeY-1;_ref>=0?_ref>=_i:_i>=_ref;y=_ref>=0?++_i:--_i)for(x=_j=0,_ref1=sizeX-1;_ref1>=0?_ref1>=_j:_j>=_ref1;x=_ref1>=0?++_j:--_j)attrs={x:x,y:y},this.add(attrs);for(mineNum=_k=1;numOfMines>=1?numOfMines>=_k:_k>=numOfMines;mineNum=numOfMines>=1?++_k:--_k)tile=this.randomSafeTile(),tile.model.isMine=!0;return this.tallyMines(),this.update(),$rootScope.$broadcast("Tiles:NewGame"),this},CollectTiles.prototype.loadGame=function(savedTiles){var tile,_i,_len;for(this.reset(),_i=0,_len=savedTiles.length;_len>_i;_i++)tile=savedTiles[_i],this.add(tile.model);return this.update()},CollectTiles.prototype.reset=function(){return this.all=[],this},CollectTiles.prototype.noMineFirstClick=function(tile){return 0===this.numOfClears&&tile.model.isMine===!0&&(tile.model.isMine=!1,this.randomSafeTile().model.isMine=!0,this.tallyMines()),tile},CollectTiles.prototype.clearNeighbors=function(tile){var adjacentTile,neighbor,shouldClearNeighbor,shouldClearNeighbors,_i,_len,_ref;if(shouldClearNeighbors=0===tile.model.adjacentMines&&tile.model.isMine===!1)for(_ref=tile.adjacentTiles,_i=0,_len=_ref.length;_len>_i;_i++)adjacentTile=_ref[_i],neighbor=this.get({x:tile.model.x+adjacentTile[0],y:tile.model.y+adjacentTile[1]}),shouldClearNeighbor=neighbor&&neighbor.model.isClear===!1&&neighbor.model.isMine===!1,shouldClearNeighbor&&neighbor.clear();return this},CollectTiles}()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25zL3RpbGVzLmNvZmZlZSIsImNvbGxlY3Rpb25zL3RpbGVzLmpzIl0sIm5hbWVzIjpbIl9faGFzUHJvcCIsImhhc093blByb3BlcnR5IiwiX19leHRlbmRzIiwiY2hpbGQiLCJwYXJlbnQiLCJjdG9yIiwidGhpcyIsImNvbnN0cnVjdG9yIiwia2V5IiwiY2FsbCIsInByb3RvdHlwZSIsIl9fc3VwZXJfXyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiTW9kZWxUaWxlIiwiJHJvb3RTY29wZSIsIkNvbGxlY3RUaWxlcyIsIndpZHRoT3JTYXZlZEdhbWUiLCJoZWlnaHQiLCJudW1PZk1pbmVzIiwiTW9kZWwiLCJjb2xsZWN0aW9uIiwidGlsZSIsIl9pIiwiX2xlbiIsIl9yZWYiLCJtb2RlbCIsIl9zdXBlciIsImFwcGx5IiwiYXJndW1lbnRzIiwiY2xlYXIiLCJjbGVhck5laWdoYm9ycyIsInVwZGF0ZSIsInRvZ2dsZUZsYWciLCJjbGljayIsIiRldmVudCIsIm5vTWluZUZpcnN0Q2xpY2siLCJBcnJheSIsImlzQXJyYXkiLCJsb2FkR2FtZSIsIngiLCJNYXRoIiwibWF4IiwiYWxsIiwibWFwIiwieSIsImxlbmd0aCIsImlzTWluZSIsIm5ld0dhbWUiLCJhZGQiLCJwdXNoIiwibG9zcyIsIndpbiIsIm51bU9mQ2xlYXJzIiwibnVtT2ZGbGFncyIsImlzQ2xlYXIiLCJpc0ZsYWdnZWQiLCIkYnJvYWRjYXN0IiwiZ2V0IiwiYXR0cnMiLCJnZXRBbGwiLCJtYXRjaGVzIiwibnVtT2ZBdHRycyIsIm51bU9mTWF0Y2hlZEF0dHJzIiwidmFsIiwiX2oiLCJfbGVuMSIsIl9yZWYxIiwidGFsbHlNaW5lcyIsImFkamFjZW50VGlsZSIsIm5laWdoYm9yQXR0cnMiLCJuZWlnaGJvck1pbmUiLCJuZWlnaGJvck1pbmVzIiwibmVpZ2hib3JYIiwibmVpZ2hib3JZIiwiYWRqYWNlbnRUaWxlcyIsImFkamFjZW50TWluZXMiLCJyYW5kb21TYWZlVGlsZSIsImZpbmRBdHRycyIsInJhbmRvbUluZGV4Iiwic2FmZVRpbGVzIiwiZmxvb3IiLCJyYW5kb20iLCJhdXRvU2VsZWN0IiwibnVtIiwic2l6ZVgiLCJzaXplWSIsIm1pbmVOdW0iLCJfayIsInJlc2V0Iiwic2F2ZWRUaWxlcyIsIm5laWdoYm9yIiwic2hvdWxkQ2xlYXJOZWlnaGJvciIsInNob3VsZENsZWFyTmVpZ2hib3JzIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxjQUFBQyxlQ0NFQyxVQUFZLFNBQVNDLE1BQU9DLFFBQWlHLFFBQVNDLFFBQVNDLEtBQUtDLFlBQWNKLE1BQTVILElBQUssR0FBSUssT0FBT0osUUFBY0osVUFBVVMsS0FBS0wsT0FBUUksT0FBTUwsTUFBTUssS0FBT0osT0FBT0ksS0FBMkosT0FBckdILE1BQUtLLFVBQVlOLE9BQU9NLFVBQVdQLE1BQU1PLFVBQVksR0FBSUwsTUFBUUYsTUFBTVEsVUFBWVAsT0FBT00sVUFBa0JQLE1ERHpSUyxTQUNDQyxPQUFPLGdCQUVKLGNBR0hDLFFBQVEsZUFBZ0IsU0FDckJDLFVBQ0FDLFlBRUEsR0FBQUMsYUNMRixPREtRQSxjQUFBLFdBQ1ksUUFBQUEsY0FBQ0MsaUJBQWtCQyxPQUFRQyxZQUdyQyxHQUFBQyxPQUFBQyxXQUFBQyxLQUFBQyxHQUFBQyxLQUFBQyxJQWlCQSxJQWpCQUosV0FBYWhCLEtBQ2JBLEtBQUNxQixNQUFjTixNQUFBLFNBQUFPLFFDSG5CLFFBQVNQLFNBQ1AsTUFBT0EsT0FBTVYsVUFBVUosWUFBWXNCLE1BQU12QixLQUFNd0IsV0FtQmpELE1EaEJRNUIsV0FBQW1CLE1BQUFPLFFBQUFQLE1BQUFYLFVBQUFxQixNQUFPLFdDR2IsTURGVVYsT0FBQVYsVUFBQW9CLE1BQUF0QixLQUFBSCxNQUNBZ0IsV0FBV1UsZUFBZTFCLE1BQzFCZ0IsV0FBV1csVUFIZlosTUFBQVgsVUFLQXdCLFdBQVksV0NHbEIsTURGVWIsT0FBQVYsVUFBQXVCLFdBQUF6QixLQUFBSCxNQUNBZ0IsV0FBV1csVUFQZlosTUFBQVgsVUFTQXlCLE1BQU8sU0FBQ0MsUUNJZCxNREhVZCxZQUFXZSxpQkFBaUIvQixNQUM1QmUsTUFBQVYsVUFBQXdCLE1BQUExQixLQUFBSCxLQUFNOEIsU0NLWGYsT0RqQjBCTixXQWdCMUJ1QixNQUFNQyxRQUFRckIsa0JBZWIsSUFkQVosS0FBQ2tDLFNBQVN0QixrQkFFVlosS0FBQ21DLEVBQUlDLEtBQUtDLElBQUlkLE1BQU12QixLQUFHQSxLQUFDc0MsSUFBSUMsSUFBSSxTQUFDdEIsTUNJdkMsTURIVUEsTUFBS0ksTUFBTWMsS0FFZm5DLEtBQUN3QyxFQUFJSixLQUFLQyxJQUFJZCxNQUFNdkIsS0FBR0EsS0FBQ3NDLElBQUlDLElBQUksU0FBQ3RCLE1DSXZDLE1ESFVBLE1BQUtJLE1BQU1tQixLQUdmeEMsS0FBQ21DLEVBQUluQyxLQUFDbUMsSUFDTm5DLEtBQUN3QyxFQUFJeEMsS0FBQ3dDLElBR054QyxLQUFDYyxXQUFhLEVBQ2RNLEtBQUFwQixLQUFBc0MsSUFBQXBCLEdBQUEsRUFBQUMsS0FBQUMsS0FBQXFCLE9BQUF0QixLQUFBRCxHQUFBQSxLQ0VORCxLQUFPRyxLQUFLRixJRERDRCxLQUFLSSxNQUFNcUIsVUFBVSxHQUNwQjFDLEtBQUNjLGlCQUdUZCxNQUFDMkMsUUFBUS9CLGlCQUFrQkMsT0FBUUMsWUFDbkNkLEtBQUNtQyxFQUFJdkIsaUJBQ0xaLEtBQUN3QyxFQUFJM0IsT0FDTGIsS0FBQ2MsV0FBYUEsV0N5TDFCLE1EcE9JSCxjQUFBUCxVQStDQXdDLElBQU0sU0FBQ3ZCLE9BQ0gsR0FBQUosS0NPTixPRFBNQSxNQUFXLEdBQUFqQixNQUFDcUIsTUFBTUEsT0FDbEJyQixLQUFDc0MsSUFBSU8sS0FBSzVCLE1BQ1ZBLE1BbERKTixhQUFBUCxVQW9EQXVCLE9BQVMsV0FDTCxHQUFBVixNQUFBQyxHQUFBQyxLQUFBQyxJQUtBLEtBTEFwQixLQUFLOEMsTUFBVSxFQUNmOUMsS0FBSytDLEtBQVUsRUFDZi9DLEtBQUtnRCxZQUFjLEVBQ25CaEQsS0FBS2lELFdBQWMsRUFFbkI3QixLQUFBcEIsS0FBQXNDLElBQUFwQixHQUFBLEVBQUFDLEtBQUFDLEtBQUFxQixPQUFBdEIsS0FBQUQsR0FBQUEsS0NRSkQsS0FBT0csS0FBS0YsSUROREQsS0FBS0ksTUFBTTZCLFdBQVcsR0FDckJsRCxLQUFLZ0QsY0FHTi9CLEtBQUtJLE1BQU04QixhQUFhLEdBQ3ZCbkQsS0FBS2lELGFBR05oQyxLQUFLSSxNQUFNcUIsVUFBVSxHQUFRekIsS0FBS0ksTUFBTTZCLFdBQVcsSUFDbERsRCxLQUFLOEMsTUFBTyxFQ1kxQixPRFRTOUMsTUFBSzhDLFFBQVEsR0FBUzlDLEtBQUNzQyxJQUFJRyxPQUFTekMsS0FBS2MsV0FBYWQsS0FBS2dELGNBQWUsSUFDekVoRCxLQUFLK0MsS0FBTSxHQUVmckMsV0FBVzBDLFdBQVcsaUJBRXRCcEQsTUE3RUpXLGFBQUFQLFVBZ0ZBaUQsSUFBTSxTQUFDQyxPQUNILE1BQU90RCxNQUFDdUQsT0FBT0QsT0FBTyxJQWpGMUIzQyxhQUFBUCxVQW1GQW1ELE9BQVMsU0FBQ0QsT0FDTixHQUFBcEQsS0FBQXNELFFBQUFDLFdBQUFDLGtCQUFBekMsS0FBQTBDLElBQUF6QyxHQUFBMEMsR0FBQXpDLEtBQUEwQyxNQUFBekMsS0FBQTBDLEtBQ0EsSUFEQU4sV0FDWSxTQUFURixNQUNDLElBQUFsQyxLQUFBcEIsS0FBQXNDLElBQUFwQixHQUFBLEVBQUFDLEtBQUFDLEtBQUFxQixPQUFBdEIsS0FBQUQsR0FBQUEsS0NRTkQsS0FBT0csS0FBS0YsSURQRnNDLFFBQVFYLEtBQUs1QixVQUVqQixLQUFBNkMsTUFBQTlELEtBQUFzQyxJQUFBc0IsR0FBQSxFQUFBQyxNQUFBQyxNQUFBckIsT0FBQW9CLE1BQUFELEdBQUFBLEtBQUEsQ0NXTjNDLEtBQU82QyxNQUFNRixJRFZISCxXQUFhLEVBQ2JDLGtCQUFvQixDQUNwQixLQUFBeEQsTUFBQW9ELE9DWVJLLElBQU1MLE1BQU1wRCxLRFhBdUQsYUFDR3hDLEtBQUtJLE1BQU1uQixPQUFReUQsS0FDbEJELG1CQUVMQSxxQkFBcUJELFlBQ3BCRCxRQUFRWCxLQUFLNUIsTUFFekIsTUFBT3VDLFVBcEdYN0MsYUFBQVAsVUFzR0EyRCxXQUFhLFdBQ1QsR0FBQUMsY0FBQUMsY0FBQUMsYUFBQUMsY0FBQUMsVUFBQUMsVUFBQXBELEtBQUFDLEdBQUEwQyxHQUFBekMsS0FBQTBDLE1BQUF6QyxLQUFBMEMsS0FBQSxLQUFBMUMsS0FBQXBCLEtBQUF1RCxTQUFBckMsR0FBQSxFQUFBQyxLQUFBQyxLQUFBcUIsT0FBQXRCLEtBQUFELEdBQUFBLEtBQUEsQ0FFSSxJQ2lCUkQsS0FBT0csS0FBS0YsSURsQkppRCxjQUFnQixFQUNoQkwsTUFBQTdDLEtBQUFxRCxjQUFBVixHQUFBLEVBQUFDLE1BQUFDLE1BQUFyQixPQUFBb0IsTUFBQUQsR0FBQUEsS0NxQk5JLGFBQWVGLE1BQU1GLElEcEJYUSxVQUFZbkQsS0FBS0ksTUFBTWMsRUFBSTZCLGFBQWEsR0FDeENLLFVBQVlwRCxLQUFLSSxNQUFNbUIsRUFBSXdCLGFBQWEsR0FDeENDLGVBQ0l2QixRQUFVLEVBQ1ZQLEVBQVVpQyxVQUNWNUIsRUFBVTZCLFdBRWRILGFBQWVsRSxLQUFLcUQsSUFBSVksZUFDSCxTQUFsQkMsY0FDQ0MsZUFDUmxELE1BQUtJLE1BQU1rRCxjQUFnQkosY0N5QnJDLE1EdkJNbkUsT0F0SEpXLGFBQUFQLFVBd0hBb0UsZUFBaUIsV0FDYixHQUFBQyxXQUFBQyxZQUFBQyxTQU1BLE9BTkFGLFlBQ0l2QixTQUFVLEVBQ1ZSLFFBQVUsR0FFZGlDLFVBQVkzRSxLQUFDdUQsT0FBT2tCLFdBQ3BCQyxZQUFjdEMsS0FBS3dDLE1BQU14QyxLQUFLeUMsU0FBV0YsVUFBVWxDLFFBQzVDa0MsVUFBV0QsY0EvSHRCL0QsYUFBQVAsVUFpSUEwRSxXQUFhLFNBQUNDLEtBQ1YsS0FBTUEsT0FDRi9FLEtBQUN3RSxpQkFBaUIvQyxPQzRCNUIsT0QxQk16QixNQUFDc0MsS0FySUwzQixhQUFBUCxVQXVJQXVDLFFBQVUsU0FBQ3FDLE1BQU9DLE1BQU9uRSxZQUNyQixHQUFBd0MsT0FBQTRCLFFBQUFqRSxLQUFBa0IsRUFBQUssRUFBQXRCLEdBQUEwQyxHQUFBdUIsR0FBQS9ELEtBQUEwQyxLQUNBLEtBREE5RCxLQUFDb0YsUUFDUTVDLEVBQUF0QixHQUFBLEVBQUFFLEtBQUE2RCxNQUFBLEVBQUE3RCxNQUFBLEVBQUFBLE1BQUFGLEdBQUFBLElBQUFFLEtBQUFvQixFQUFBcEIsTUFBQSxJQUFBRixLQUFBQSxHQUNMLElBQVNpQixFQUFBeUIsR0FBQSxFQUFBRSxNQUFBa0IsTUFBQSxFQUFBbEIsT0FBQSxFQUFBQSxPQUFBRixHQUFBQSxJQUFBRSxNQUFBM0IsRUFBQTJCLE9BQUEsSUFBQUYsS0FBQUEsR0FDTE4sT0FDSW5CLEVBQU1BLEVBQ05LLEVBQU1BLEdBRVZ4QyxLQUFDNEMsSUFBSVUsTUFFYixLQUFlNEIsUUFBQUMsR0FBQSxFQUFBckUsWUFBQSxFQUFBQSxZQUFBcUUsR0FBQUEsSUFBQXJFLFdBQUFvRSxRQUFBcEUsWUFBQSxJQUFBcUUsS0FBQUEsR0FDWGxFLEtBQU9qQixLQUFDd0UsaUJBQ1J2RCxLQUFLSSxNQUFNcUIsUUFBUyxDQ2tDOUIsT0RoQ00xQyxNQUFDK0QsYUFDRC9ELEtBQUMyQixTQUNEakIsV0FBVzBDLFdBQVcsaUJBQ3RCcEQsTUF4SkpXLGFBQUFQLFVBMEpBOEIsU0FBVyxTQUFDbUQsWUFDUixHQUFBcEUsTUFBQUMsR0FBQUMsSUFDQSxLQURBbkIsS0FBQ29GLFFBQ0RsRSxHQUFBLEVBQUFDLEtBQUFrRSxXQUFBNUMsT0FBQXRCLEtBQUFELEdBQUFBLEtDZ0NKRCxLQUFPb0UsV0FBV25FLElEL0JWbEIsS0FBQzRDLElBQUkzQixLQUFLSSxNQ2tDcEIsT0RqQ01yQixNQUFDMkIsVUE5SkxoQixhQUFBUCxVQWdLQWdGLE1BQVEsV0NvQ1YsTURuQ01wRixNQUFDc0MsT0FDRHRDLE1BbEtKVyxhQUFBUCxVQW9LQTJCLGlCQUFrQixTQUFDZCxNQU1mLE1BTG1CLEtBQWhCakIsS0FBQ2dELGFBQXFCL0IsS0FBS0ksTUFBTXFCLFVBQVUsSUFDMUN6QixLQUFLSSxNQUFNcUIsUUFBUyxFQUNwQjFDLEtBQUN3RSxpQkFBaUJuRCxNQUFNcUIsUUFBUyxFQUNqQzFDLEtBQUMrRCxjQUVFOUMsTUExS1hOLGFBQUFQLFVBNEtBc0IsZUFBaUIsU0FBQ1QsTUFDZCxHQUFBK0MsY0FBQXNCLFNBQUFDLG9CQUFBQyxxQkFBQXRFLEdBQUFDLEtBQUFDLElBQ0EsSUFEQW9FLHFCQUFtRCxJQUE1QnZFLEtBQUtJLE1BQU1rRCxlQUF1QnRELEtBQUtJLE1BQU1xQixVQUFVLEVBRTFFLElBQUF0QixLQUFBSCxLQUFBcUQsY0FBQXBELEdBQUEsRUFBQUMsS0FBQUMsS0FBQXFCLE9BQUF0QixLQUFBRCxHQUFBQSxLQ3VDTjhDLGFBQWU1QyxLQUFLRixJRHRDVm9FLFNBQVd0RixLQUFDcUQsS0FDUmxCLEVBQUlsQixLQUFLSSxNQUFNYyxFQUFJNkIsYUFBYSxHQUNoQ3hCLEVBQUl2QixLQUFLSSxNQUFNbUIsRUFBSXdCLGFBQWEsS0FHcEN1QixvQkFDSUQsVUFDQUEsU0FBU2pFLE1BQU02QixXQUFXLEdBQzFCb0MsU0FBU2pFLE1BQU1xQixVQUFVLEVBRzFCNkMscUJBQ0NELFNBQVM3RCxPQ3FDM0IsT0RuQ016QixPQ3NDRFciLCJmaWxlIjoiY29sbGVjdGlvbnMvdGlsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyXG4ubW9kdWxlICdDb2xsZWN0VGlsZXMnLCBbXG4jIERlcGVuZGVuY2llc1xuICAgICdNb2RlbFRpbGUnLFxuXVxuXG4uZmFjdG9yeSAnQ29sbGVjdFRpbGVzJywgKFxuICAgIE1vZGVsVGlsZSxcbiAgICAkcm9vdFNjb3BlXG4pIC0+XG4gICAgY2xhc3MgQ29sbGVjdFRpbGVzXG4gICAgICAgIGNvbnN0cnVjdG9yIDogKHdpZHRoT3JTYXZlZEdhbWUsIGhlaWdodCwgbnVtT2ZNaW5lcykgLT5cblxuICAgICAgICAgICAgIyBFeHRlbmQgTW9kZWxUaWxlIHNvIHRoYXQgaXQgY2FuIGV4ZWN1dGUgc29tZSBjb2xsZWN0aW9uIGxvZ2ljXG4gICAgICAgICAgICBjb2xsZWN0aW9uID0gQFxuICAgICAgICAgICAgQG1vZGVsID0gY2xhc3MgTW9kZWwgZXh0ZW5kcyBNb2RlbFRpbGVcbiAgICAgICAgICAgICAgICBjbGVhcjogLT5cbiAgICAgICAgICAgICAgICAgICAgc3VwZXIoKVxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmNsZWFyTmVpZ2hib3JzIEBcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi51cGRhdGUoKVxuXG4gICAgICAgICAgICAgICAgdG9nZ2xlRmxhZzogLT5cbiAgICAgICAgICAgICAgICAgICAgc3VwZXIoKVxuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLnVwZGF0ZSgpXG5cbiAgICAgICAgICAgICAgICBjbGljazogKCRldmVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5ub01pbmVGaXJzdENsaWNrIEBcbiAgICAgICAgICAgICAgICAgICAgc3VwZXIgJGV2ZW50XG5cblxuICAgICAgICAgICAgIyBMb2FkIG9yIENyZWF0ZSBuZXcgZ2FtZVxuICAgICAgICAgICAgaWYgQXJyYXkuaXNBcnJheSB3aWR0aE9yU2F2ZWRHYW1lXG4gICAgICAgICAgICAgICAgQGxvYWRHYW1lIHdpZHRoT3JTYXZlZEdhbWVcblxuICAgICAgICAgICAgICAgIEB4ID0gTWF0aC5tYXguYXBwbHkgQCwgQGFsbC5tYXAgKHRpbGUpIC0+XG4gICAgICAgICAgICAgICAgICAgIHRpbGUubW9kZWwueFxuXG4gICAgICAgICAgICAgICAgQHkgPSBNYXRoLm1heC5hcHBseSBALCBAYWxsLm1hcCAodGlsZSkgLT5cbiAgICAgICAgICAgICAgICAgICAgdGlsZS5tb2RlbC55XG5cbiAgICAgICAgICAgICAgICAjIE9mZnNldCBieSAxIHRvIGFjY291bnQgZm9yIDAgaW5kZXhcbiAgICAgICAgICAgICAgICBAeCA9IEB4LS1cbiAgICAgICAgICAgICAgICBAeSA9IEB5LS1cblxuXG4gICAgICAgICAgICAgICAgQG51bU9mTWluZXMgPSAwXG4gICAgICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGFsbFxuICAgICAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsLmlzTWluZSBpcyB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICBAbnVtT2ZNaW5lcysrXG5cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBAbmV3R2FtZSB3aWR0aE9yU2F2ZWRHYW1lLCBoZWlnaHQsIG51bU9mTWluZXNcbiAgICAgICAgICAgICAgICBAeCA9IHdpZHRoT3JTYXZlZEdhbWVcbiAgICAgICAgICAgICAgICBAeSA9IGhlaWdodFxuICAgICAgICAgICAgICAgIEBudW1PZk1pbmVzID0gbnVtT2ZNaW5lc1xuXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgYWRkIDogKG1vZGVsKSAtPlxuICAgICAgICAgICAgdGlsZSA9IG5ldyBAbW9kZWwgbW9kZWxcbiAgICAgICAgICAgIEBhbGwucHVzaCB0aWxlXG4gICAgICAgICAgICB0aWxlXG5cbiAgICAgICAgdXBkYXRlIDogLT5cbiAgICAgICAgICAgIHRoaXMubG9zcyAgICA9IGZhbHNlXG4gICAgICAgICAgICB0aGlzLndpbiAgICAgPSBmYWxzZVxuICAgICAgICAgICAgdGhpcy5udW1PZkNsZWFycyA9IDBcbiAgICAgICAgICAgIHRoaXMubnVtT2ZGbGFncyAgPSAwXG5cbiAgICAgICAgICAgIGZvciB0aWxlIGluIEBhbGxcbiAgICAgICAgICAgICAgICAjIENsZWFyZWQgVGlsZXNcbiAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsLmlzQ2xlYXIgPT0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm51bU9mQ2xlYXJzKytcblxuICAgICAgICAgICAgICAgICMgRmxhZ2dlZCBUaWxlc1xuICAgICAgICAgICAgICAgIGlmIHRpbGUubW9kZWwuaXNGbGFnZ2VkID09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1PZkZsYWdzKytcblxuICAgICAgICAgICAgICAgICMgQ2hlY2sgR2FtZSBMb3NzXG4gICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbC5pc01pbmUgPT0gdHJ1ZSAmJiB0aWxlLm1vZGVsLmlzQ2xlYXIgPT0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvc3MgPSB0cnVlXG5cbiAgICAgICAgICAgICMgQ2hlY2sgR2FtZSBXaW5cbiAgICAgICAgICAgIGlmIHRoaXMubG9zcyA9PSBmYWxzZSAmJiBAYWxsLmxlbmd0aCAtIHRoaXMubnVtT2ZNaW5lcyAtIHRoaXMubnVtT2ZDbGVhcnMgPT0gMFxuICAgICAgICAgICAgICAgIHRoaXMud2luID0gdHJ1ZVxuXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QgJ1RpbGVzOlVwZGF0ZWQnXG5cbiAgICAgICAgICAgIEBcblxuXG4gICAgICAgIGdldCA6IChhdHRycykgLT5cbiAgICAgICAgICAgIHJldHVybiBAZ2V0QWxsKGF0dHJzKVswXVxuXG4gICAgICAgIGdldEFsbCA6IChhdHRycykgLT5cbiAgICAgICAgICAgIG1hdGNoZXMgPSBbXVxuICAgICAgICAgICAgaWYgYXR0cnMgaXMgdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgZm9yIHRpbGUgaW4gQGFsbFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2ggdGlsZVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGZvciB0aWxlIGluIEBhbGxcbiAgICAgICAgICAgICAgICAgICAgbnVtT2ZBdHRycyA9IDBcbiAgICAgICAgICAgICAgICAgICAgbnVtT2ZNYXRjaGVkQXR0cnMgPSAwXG4gICAgICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbCBvZiBhdHRyc1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZBdHRycysrXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiB0aWxlLm1vZGVsW2tleV0gaXMgdmFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZNYXRjaGVkQXR0cnMrK1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIG51bU9mTWF0Y2hlZEF0dHJzIGlzIG51bU9mQXR0cnNcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMucHVzaCB0aWxlXG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzXG5cbiAgICAgICAgdGFsbHlNaW5lcyA6ICgpIC0+XG4gICAgICAgICAgICBmb3IgdGlsZSBpbiBAZ2V0QWxsKClcbiAgICAgICAgICAgICAgICBuZWlnaGJvck1pbmVzID0gMFxuICAgICAgICAgICAgICAgIGZvciBhZGphY2VudFRpbGUgaW4gdGlsZS5hZGphY2VudFRpbGVzXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yWCA9IHRpbGUubW9kZWwueCArIGFkamFjZW50VGlsZVswXSBcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JZID0gdGlsZS5tb2RlbC55ICsgYWRqYWNlbnRUaWxlWzFdXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yQXR0cnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc01pbmUgIDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgeCAgICAgICA6IG5laWdoYm9yWFxuICAgICAgICAgICAgICAgICAgICAgICAgeSAgICAgICA6IG5laWdoYm9yWVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yTWluZSA9IHRoaXMuZ2V0KG5laWdoYm9yQXR0cnMpXG4gICAgICAgICAgICAgICAgICAgIGlmIG5laWdoYm9yTWluZSBpc250IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lcysrXG4gICAgICAgICAgICAgICAgdGlsZS5tb2RlbC5hZGphY2VudE1pbmVzID0gbmVpZ2hib3JNaW5lc1xuXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgcmFuZG9tU2FmZVRpbGUgOiAoKSAtPlxuICAgICAgICAgICAgZmluZEF0dHJzID1cbiAgICAgICAgICAgICAgICBpc0NsZWFyIDogZmFsc2VcbiAgICAgICAgICAgICAgICBpc01pbmUgIDogZmFsc2VcblxuICAgICAgICAgICAgc2FmZVRpbGVzID0gQGdldEFsbCBmaW5kQXR0cnNcbiAgICAgICAgICAgIHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vciBNYXRoLnJhbmRvbSgpICogc2FmZVRpbGVzLmxlbmd0aFxuICAgICAgICAgICAgcmV0dXJuIHNhZmVUaWxlc1sgcmFuZG9tSW5kZXggXVxuXG4gICAgICAgIGF1dG9TZWxlY3QgOiAobnVtKSAtPlxuICAgICAgICAgICAgd2hpbGUgbnVtLS1cbiAgICAgICAgICAgICAgICBAcmFuZG9tU2FmZVRpbGUoKS5jbGVhcigpXG5cbiAgICAgICAgICAgIEBhbGxcblxuICAgICAgICBuZXdHYW1lIDogKHNpemVYLCBzaXplWSwgbnVtT2ZNaW5lcykgLT5cbiAgICAgICAgICAgIEByZXNldCgpXG4gICAgICAgICAgICBmb3IgeSBpbiBbMC4uc2l6ZVkgLSAxXVxuICAgICAgICAgICAgICAgIGZvciB4IGluIFswLi5zaXplWCAtIDFdXG4gICAgICAgICAgICAgICAgICAgIGF0dHJzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgeCAgIDogeFxuICAgICAgICAgICAgICAgICAgICAgICAgeSAgIDogeVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEBhZGQgYXR0cnNcblxuICAgICAgICAgICAgZm9yIG1pbmVOdW0gaW4gWzEuLm51bU9mTWluZXNdXG4gICAgICAgICAgICAgICAgdGlsZSA9IEByYW5kb21TYWZlVGlsZSgpXG4gICAgICAgICAgICAgICAgdGlsZS5tb2RlbC5pc01pbmUgPSB0cnVlXG5cbiAgICAgICAgICAgIEB0YWxseU1pbmVzKClcbiAgICAgICAgICAgIEB1cGRhdGUoKVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0ICdUaWxlczpOZXdHYW1lJ1xuICAgICAgICAgICAgQFxuXG4gICAgICAgIGxvYWRHYW1lIDogKHNhdmVkVGlsZXMpIC0+XG4gICAgICAgICAgICBAcmVzZXQoKVxuICAgICAgICAgICAgZm9yIHRpbGUgaW4gc2F2ZWRUaWxlc1xuICAgICAgICAgICAgICAgIEBhZGQgdGlsZS5tb2RlbFxuICAgICAgICAgICAgQHVwZGF0ZSgpXG5cbiAgICAgICAgcmVzZXQgOiAtPlxuICAgICAgICAgICAgQGFsbCA9IFtdXG4gICAgICAgICAgICBAXG5cbiAgICAgICAgbm9NaW5lRmlyc3RDbGljazogKHRpbGUpIC0+XG4gICAgICAgICAgICBpZiBAbnVtT2ZDbGVhcnMgaXMgMCBhbmQgdGlsZS5tb2RlbC5pc01pbmUgaXMgdHJ1ZVxuICAgICAgICAgICAgICAgIHRpbGUubW9kZWwuaXNNaW5lID0gZmFsc2VcbiAgICAgICAgICAgICAgICBAcmFuZG9tU2FmZVRpbGUoKS5tb2RlbC5pc01pbmUgPSB0cnVlXG4gICAgICAgICAgICAgICAgQHRhbGx5TWluZXMoKVxuXG4gICAgICAgICAgICByZXR1cm4gdGlsZVxuXG4gICAgICAgIGNsZWFyTmVpZ2hib3JzIDogKHRpbGUpIC0+XG4gICAgICAgICAgICBzaG91bGRDbGVhck5laWdoYm9ycyA9IHRpbGUubW9kZWwuYWRqYWNlbnRNaW5lcyBpcyAwIGFuZCB0aWxlLm1vZGVsLmlzTWluZSBpcyBmYWxzZVxuICAgICAgICAgICAgaWYgc2hvdWxkQ2xlYXJOZWlnaGJvcnNcbiAgICAgICAgICAgICAgICBmb3IgYWRqYWNlbnRUaWxlIGluIHRpbGUuYWRqYWNlbnRUaWxlc1xuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvciA9IEBnZXQoXG4gICAgICAgICAgICAgICAgICAgICAgICB4IDogdGlsZS5tb2RlbC54ICsgYWRqYWNlbnRUaWxlWzBdXG4gICAgICAgICAgICAgICAgICAgICAgICB5IDogdGlsZS5tb2RlbC55ICsgYWRqYWNlbnRUaWxlWzFdXG4gICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICBzaG91bGRDbGVhck5laWdoYm9yID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IgYW5kXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWlnaGJvci5tb2RlbC5pc0NsZWFyIGlzIGZhbHNlIGFuZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3IubW9kZWwuaXNNaW5lIGlzIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICBpZiBzaG91bGRDbGVhck5laWdoYm9yXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWlnaGJvci5jbGVhcigpXG5cbiAgICAgICAgICAgIEAiLG51bGxdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==