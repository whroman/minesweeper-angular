angular.module("CollectTiles",["ModelTile","angularLocalStorage"]).factory("CollectTiles",function(storage,ModelTile){var add,autoSelect,exposeToModel,get,getAll,loadGame,newGame,randomSafeTile,tallyMines,tiles;return tiles=[],exposeToModel=function(){return{collection:{get:function(_this){return function(attrs){return _this.get(attrs)}}(this),getAll:function(_this){return function(attrs){return _this.getAll(attrs)}}(this)}}},get=function(attrs){return this.getAll(attrs)[0]},getAll=function(attrs){var key,matches,numOfAttrs,numOfMatchedAttrs,tile,val,_i,_j,_len,_len1,_ref,_ref1;if(matches=[],void 0===attrs)for(_ref=this.tiles,_i=0,_len=_ref.length;_len>_i;_i++)tile=_ref[_i],matches.push(tile);else for(_ref1=this.tiles,_j=0,_len1=_ref1.length;_len1>_j;_j++){tile=_ref1[_j],numOfAttrs=0,numOfMatchedAttrs=0;for(key in attrs)val=attrs[key],numOfAttrs++,tile.model[key]===val&&numOfMatchedAttrs++;numOfMatchedAttrs===numOfAttrs&&matches.push(tile)}return matches},tallyMines=function(){var adjacentTile,neighborAttrs,neighborMine,neighborMines,neighborX,neighborY,tile,_i,_j,_len,_len1,_ref,_ref1;for(_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++){for(tile=_ref[_i],neighborMines=0,_ref1=tile.adjacentTiles,_j=0,_len1=_ref1.length;_len1>_j;_j++)adjacentTile=_ref1[_j],neighborX=tile.model.x+adjacentTile[0],neighborY=tile.model.y+adjacentTile[1],neighborAttrs={isMine:!0,x:neighborX,y:neighborY},neighborMine=this.get(neighborAttrs),void 0!==neighborMine&&neighborMines++;tile.model.adjacentMines=neighborMines}return this},randomSafeTile=function(){var findAttrs,randomTile,safeTiles;return findAttrs={isClear:!1,isMine:!1},safeTiles=this.getAll(findAttrs),randomTile=safeTiles[Math.floor(Math.random()*safeTiles.length)]},autoSelect=function(num){for(var tile;num--;)tile=this.randomSafeTile(),tile.clear();return this.tiles},newGame=function(sizeX,sizeY,numOfMines){var attrs,mineNum,tile,x,y,_i,_j,_k,_ref,_ref1;for(this.tiles=[],y=_i=0,_ref=sizeY-1;_ref>=0?_ref>=_i:_i>=_ref;y=_ref>=0?++_i:--_i)for(x=_j=0,_ref1=sizeX-1;_ref1>=0?_ref1>=_j:_j>=_ref1;x=_ref1>=0?++_j:--_j)attrs={x:x,y:y},this.add(attrs);for(mineNum=_k=1;numOfMines>=1?numOfMines>=_k:_k>=numOfMines;mineNum=numOfMines>=1?++_k:--_k)tile=this.randomSafeTile(),tile.model.isMine=!0;return this.tallyMines(),this},loadGame=function(savedTiles){var tile,_i,_len;for(this.tiles=[],_i=0,_len=savedTiles.length;_len>_i;_i++)tile=savedTiles[_i],this.add(tile.model);return this},add=function(model){var tile;return tile=ModelTile(model).extend(this.exposeToModel()),this.tiles.push(tile)},{tiles:tiles,newGame:newGame,loadGame:loadGame,randomSafeTile:randomSafeTile,tallyMines:tallyMines,get:get,getAll:getAll,add:add,autoSelect:autoSelect,exposeToModel:exposeToModel}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25zL3RpbGVzL2NvbGxlY3Rpb24uY29mZmVlIiwiY29sbGVjdGlvbnMvdGlsZXMvY29sbGVjdGlvbi5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZmFjdG9yeSIsInN0b3JhZ2UiLCJNb2RlbFRpbGUiLCJhZGQiLCJhdXRvU2VsZWN0IiwiZXhwb3NlVG9Nb2RlbCIsImdldCIsImdldEFsbCIsImxvYWRHYW1lIiwibmV3R2FtZSIsInJhbmRvbVNhZmVUaWxlIiwidGFsbHlNaW5lcyIsInRpbGVzIiwiY29sbGVjdGlvbiIsIl90aGlzIiwiYXR0cnMiLCJ0aGlzIiwia2V5IiwibWF0Y2hlcyIsIm51bU9mQXR0cnMiLCJudW1PZk1hdGNoZWRBdHRycyIsInRpbGUiLCJ2YWwiLCJfaSIsIl9qIiwiX2xlbiIsIl9sZW4xIiwiX3JlZiIsIl9yZWYxIiwibGVuZ3RoIiwicHVzaCIsIm1vZGVsIiwiYWRqYWNlbnRUaWxlIiwibmVpZ2hib3JBdHRycyIsIm5laWdoYm9yTWluZSIsIm5laWdoYm9yTWluZXMiLCJuZWlnaGJvclgiLCJuZWlnaGJvclkiLCJhZGphY2VudFRpbGVzIiwieCIsInkiLCJpc01pbmUiLCJhZGphY2VudE1pbmVzIiwiZmluZEF0dHJzIiwicmFuZG9tVGlsZSIsInNhZmVUaWxlcyIsImlzQ2xlYXIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJudW0iLCJjbGVhciIsInNpemVYIiwic2l6ZVkiLCJudW1PZk1pbmVzIiwibWluZU51bSIsIl9rIiwic2F2ZWRUaWxlcyIsImV4dGVuZCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQ0NDLE9BQU8sZ0JBRUosWUFDQSx3QkFHSEMsUUFBUSxlQUFnQixTQUFDQyxRQUFTQyxXQUMvQixHQUFBQyxLQUFBQyxXQUFBQyxjQUFBQyxJQUFBQyxPQUFBQyxTQUFBQyxRQUFBQyxlQUFBQyxXQUFBQyxLQW9HQSxPQXBHQUEsVUFFQVAsY0FBZ0IsV0FDWixPQUNJUSxZQUNJUCxJQUFVLFNB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WUFBQSxJQUFBRSxLQUFBQSxHQUNYbkMsS0FBT0wsS0FBS04saUJBQ1pXLEtBQUtVLE1BQU1VLFFBQVMsQ0FJeEIsT0FGQXpCLE1BQUtMLGFBRUVLLE1BRVhSLFNBQVcsU0FBQ2lELFlBQ1IsR0FBQXBDLE1BQUFFLEdBQUFFLElBQ0EsS0FEQVQsS0FBS0osU0FDTFcsR0FBQSxFQUFBRSxLQUFBZ0MsV0FBQTVCLE9BQUFKLEtBQUFGLEdBQUFBLEtDa0JGRixLQUFPb0MsV0FBV2xDLElEakJaUCxLQUFLYixJQUFJa0IsS0FBS1UsTUFFbEIsT0FBT2YsT0FFWGIsSUFBTSxTQUFDNEIsT0FDSCxHQUFBVixLQ29CSixPRHBCSUEsTUFBT25CLFVBQVU2QixPQUFPMkIsT0FBTzFDLEtBQUtYLGlCQUNwQ1csS0FBS0osTUFBTWtCLEtBQUtULFFBR2hCVCxNQUFjQSxNQUNkSCxRQUFjQSxRQUNkRCxTQUFjQSxTQUNkRSxlQUFrQkEsZUFDbEJDLFdBQWNBLFdBQ2RMLElBQWNBLElBQ2RDLE9BQWNBLE9BQ2RKLElBQWNBLElBQ2RDLFdBQWNBLFdBQ2RDLGNBQWlCQSIsImZpbGUiOiJjb2xsZWN0aW9ucy90aWxlcy9jb2xsZWN0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhclxuLm1vZHVsZSAnQ29sbGVjdFRpbGVzJywgW1xuIyBEZXBlbmRlbmNpZXNcbiAgICAnTW9kZWxUaWxlJyxcbiAgICAnYW5ndWxhckxvY2FsU3RvcmFnZSdcbl1cblxuLmZhY3RvcnkgJ0NvbGxlY3RUaWxlcycsIChzdG9yYWdlLCBNb2RlbFRpbGUpIC0+XG4gICAgdGlsZXMgPSBbXVxuXG4gICAgZXhwb3NlVG9Nb2RlbCA9ICgpIC0+XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb2xsZWN0aW9uICA6IHtcbiAgICAgICAgICAgICAgICBnZXQgICAgIDogKGF0dHJzKSA9PlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldChhdHRycylcbiAgICAgICAgICAgICAgICBnZXRBbGwgIDogKGF0dHJzKSA9PlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEFsbChhdHRycylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgZ2V0ID0gKGF0dHJzKSAtPlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGwoYXR0cnMpWzBdXG5cbiAgICBnZXRBbGwgPSAoYXR0cnMpIC0+XG4gICAgICAgIG1hdGNoZXMgPSBbXVxuICAgICAgICBpZiBhdHRycyBpcyB1bmRlZmluZWRcbiAgICAgICAgICAgIGZvciB0aWxlIGluIHRoaXMudGlsZXNcbiAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2godGlsZSlcbiAgICAgICAgZWxzZSBcbiAgICAgICAgICAgIGZvciB0aWxlIGluIHRoaXMudGlsZXNcbiAgICAgICAgICAgICAgICBudW1PZkF0dHJzID0gMFxuICAgICAgICAgICAgICAgIG51bU9mTWF0Y2hlZEF0dHJzID0gMFxuICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbCBvZiBhdHRyc1xuICAgICAgICAgICAgICAgICAgICBudW1PZkF0dHJzKytcbiAgICAgICAgICAgICAgICAgICAgaWYgdGlsZS5tb2RlbFtrZXldID09IHZhbFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZNYXRjaGVkQXR0cnMrK1xuXG4gICAgICAgICAgICAgICAgaWYgbnVtT2ZNYXRjaGVkQXR0cnMgPT0gbnVtT2ZBdHRyc1xuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2godGlsZSlcblxuICAgICAgICByZXR1cm4gbWF0Y2hlc1xuXG4gICAgdGFsbHlNaW5lcyA9ICgpIC0+XG4gICAgICAgIGZvciB0aWxlIGluIHRoaXMuZ2V0QWxsKClcbiAgICAgICAgICAgIG5laWdoYm9yTWluZXMgPSAwXG4gICAgICAgICAgICBmb3IgYWRqYWNlbnRUaWxlIGluIHRpbGUuYWRqYWNlbnRUaWxlc1xuICAgICAgICAgICAgICAgIG5laWdoYm9yWCA9IHRpbGUubW9kZWwueCArIGFkamFjZW50VGlsZVswXSBcbiAgICAgICAgICAgICAgICBuZWlnaGJvclkgPSB0aWxlLm1vZGVsLnkgKyBhZGphY2VudFRpbGVbMV1cbiAgICAgICAgICAgICAgICBuZWlnaGJvckF0dHJzID0ge1xuICAgICAgICAgICAgICAgICAgICBpc01pbmUgIDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB4ICAgICAgIDogbmVpZ2hib3JYXG4gICAgICAgICAgICAgICAgICAgIHkgICAgICAgOiBuZWlnaGJvcllcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lID0gdGhpcy5nZXQobmVpZ2hib3JBdHRycylcbiAgICAgICAgICAgICAgICBpZiBuZWlnaGJvck1pbmUgaXNudCB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JNaW5lcysrXG4gICAgICAgICAgICB0aWxlLm1vZGVsLmFkamFjZW50TWluZXMgPSBuZWlnaGJvck1pbmVzXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcblxuICAgIHJhbmRvbVNhZmVUaWxlID0gKCkgLT5cbiAgICAgICAgZmluZEF0dHJzID0ge1xuICAgICAgICAgICAgaXNDbGVhciA6IGZhbHNlXG4gICAgICAgICAgICBpc01pbmUgIDogZmFsc2VcbiAgICAgICAgfVxuICAgICAgICBzYWZlVGlsZXMgPSB0aGlzLmdldEFsbCBmaW5kQXR0cnNcblxuICAgICAgICByYW5kb21UaWxlID0gc2FmZVRpbGVzWyBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogc2FmZVRpbGVzLmxlbmd0aCkgXVxuXG4gICAgICAgIHJldHVybiByYW5kb21UaWxlXG5cblxuICAgIGF1dG9TZWxlY3QgPSAobnVtKSAtPlxuICAgICAgICB3aGlsZSBudW0tLVxuICAgICAgICAgICAgdGlsZSA9IHRoaXMucmFuZG9tU2FmZVRpbGUoKVxuICAgICAgICAgICAgdGlsZS5jbGVhcigpXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdGhpcy50aWxlc1xuXG4gICAgbmV3R2FtZSA9IChzaXplWCwgc2l6ZVksIG51bU9mTWluZXMpIC0+XG4gICAgICAgIHRoaXMudGlsZXMgPSBbXVxuICAgICAgICBmb3IgeSBpbiBbMC4uc2l6ZVkgLSAxXVxuICAgICAgICAgICAgZm9yIHggaW4gWzAuLnNpemVYIC0gMV1cbiAgICAgICAgICAgICAgICBhdHRycyA9IHtcbiAgICAgICAgICAgICAgICAgICAgeCAgIDogeFxuICAgICAgICAgICAgICAgICAgICB5ICAgOiB5XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYWRkKGF0dHJzKVxuXG4gICAgICAgIGZvciBtaW5lTnVtIGluIFsxLi5udW1PZk1pbmVzXVxuICAgICAgICAgICAgdGlsZSA9IHRoaXMucmFuZG9tU2FmZVRpbGUoKVxuICAgICAgICAgICAgdGlsZS5tb2RlbC5pc01pbmUgPSB0cnVlXG4gICAgICAgIFxuICAgICAgICB0aGlzLnRhbGx5TWluZXMoKVxuXG4gICAgICAgIHJldHVybiB0aGlzXG5cbiAgICBsb2FkR2FtZSA9IChzYXZlZFRpbGVzKSAtPlxuICAgICAgICB0aGlzLnRpbGVzID0gW11cbiAgICAgICAgZm9yIHRpbGUgaW4gc2F2ZWRUaWxlc1xuICAgICAgICAgICAgdGhpcy5hZGQodGlsZS5tb2RlbClcblxuICAgICAgICByZXR1cm4gdGhpc1xuXG4gICAgYWRkID0gKG1vZGVsKSAtPlxuICAgICAgICB0aWxlID0gTW9kZWxUaWxlKG1vZGVsKS5leHRlbmQodGhpcy5leHBvc2VUb01vZGVsKCkpXG4gICAgICAgIHRoaXMudGlsZXMucHVzaCh0aWxlKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGlsZXMgICAgICAgOiB0aWxlc1xuICAgICAgICBuZXdHYW1lICAgICA6IG5ld0dhbWVcbiAgICAgICAgbG9hZEdhbWUgICAgOiBsb2FkR2FtZVxuICAgICAgICByYW5kb21TYWZlVGlsZSAgOiByYW5kb21TYWZlVGlsZVxuICAgICAgICB0YWxseU1pbmVzICA6IHRhbGx5TWluZXNcbiAgICAgICAgZ2V0ICAgICAgICAgOiBnZXRcbiAgICAgICAgZ2V0QWxsICAgICAgOiBnZXRBbGxcbiAgICAgICAgYWRkICAgICAgICAgOiBhZGRcbiAgICAgICAgYXV0b1NlbGVjdCAgOiBhdXRvU2VsZWN0XG4gICAgICAgIGV4cG9zZVRvTW9kZWwgIDogZXhwb3NlVG9Nb2RlbFxuICAgIH0iLG51bGxdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==